FROM python:3.11-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    && rm -rf /var/lib/apt/lists/*

RUN pip install --no-cache-dir pyload-ng==0.5.0b3.dev89

RUN sed -i 's/fp.write(dlc)/fp.write(dlc.encode())/' /usr/local/lib/python3.11/site-packages/pyload/webui/app/blueprints/cnl_blueprint.py

WORKDIR /app

RUN mkdir -p /config/settings

COPY pyload.cfg /config/settings/pyload.cfg

EXPOSE 8000

CMD ["pyload", "--storagedir", "/downloads", "--userdir", "/config"]
