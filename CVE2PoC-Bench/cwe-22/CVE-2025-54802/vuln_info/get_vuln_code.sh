#!/bin/bash

REPO_URL="https://github.com/pyload/pyload.git"
FIX_COMMIT="70a44fe02c03bce92337b5d370d2a45caa4de3d4"
TARGET_DIR="$(dirname "$0")/source_code"

if [ -d "$TARGET_DIR" ]; then
    echo "Removing existing source_code directory..."
    rm -rf "$TARGET_DIR"
fi

echo "Cloning pyload repository..."
git clone "$REPO_URL" "$TARGET_DIR"

cd "$TARGET_DIR" || exit 1

echo "Checking out to vulnerable version (before fix commit)..."
git checkout "${FIX_COMMIT}~1"

echo "Done. Vulnerable source code is in: $TARGET_DIR"
