# CVE-2025-32028 Vulnerability Report

## Vulnerability Overview

- **CVE ID**: CVE-2025-32028
- **CWE ID**: CWE-434 (Unrestricted Upload of File with Dangerous Type)
- **CVSS Score**: 9.9 (Critical)
- **Affected Software**: HAX CMS PHP
- **Affected Versions**: 9.0.0 - 10.0.2
- **Fixed Version**: 10.0.3

## Vulnerability Description

Multiple file upload functions within the HAX CMS PHP application call a 'save' function in 'HAXCMSFile.php'. This save function uses a denylist to block specific file types from being uploaded to the server. This list is non-exhaustive and only blocks '.php', '.sh', '.js', and '.css' files. The existing logic causes the system to "fail open" rather than "fail closed."

## Vulnerable Code

The vulnerability exists in `system/backend/php/lib/HAXCMSFile.php`:

```php
if (
    isset($upload['tmp_name']) &&
    (is_uploaded_file($upload['tmp_name']) || isset($upload['bulk-import'])) &&
    strpos($name, '.php') === FALSE &&
    strpos($name, '.sh') === FALSE &&
    strpos($name, '.js') === FALSE &&
    strpos($name, '.css') === FALSE
) {
```

## Attack Chain

1. Authenticate as a valid user (low privilege required)
2. Create a new site via `/system/api/createSite`
3. Upload `.htaccess` file to the site's files directory with content: `AddHandler application/x-httpd-php .phar`
4. Upload PHP webshell with `.phar` extension to the same directory
5. Access the uploaded `.phar` file to execute arbitrary commands

## Key Points

- The denylist does NOT block `.htaccess` files
- The denylist does NOT block `.phar` files
- By uploading `.htaccess` first, attacker can configure Apache to execute `.phar` files as PHP
- Requires `AllowOverride All` in Apache configuration (common in many deployments)

## Proof of Concept Results

```
=== CVE-2025-32028 RCE Verification ===

Uploaded .htaccess content:
AddHandler application/x-httpd-php .phar

Uploaded webshell: shell_c0pkaufr.phar
Path: /_sites/blank/files/shell_c0pkaufr.phar

Command: id
Output: uid=33(www-data) gid=33(www-data) groups=33(www-data)

Command: whoami
Output: www-data

[+] RCE VERIFIED SUCCESSFULLY
```

## Impact

An authenticated attacker can:
1. Upload arbitrary files bypassing the incomplete denylist
2. Configure Apache via `.htaccess` to execute non-standard PHP extensions
3. Gain remote code execution as the web server user (www-data)
4. Potentially compromise all HAX CMS sites on the server

## Remediation

1. Update HAX CMS PHP to version 10.0.3 or later
2. Implement allowlist-based file validation instead of denylist
3. Block `.htaccess` uploads explicitly
4. Disable `AllowOverride` in Apache configuration if not needed
5. Implement content-type validation beyond extension checking

## References

- GitHub Security Advisory: https://github.com/haxtheweb/issues/security/advisories/GHSA-vj5q-3jv2-cg5p
- NVD: https://nvd.nist.gov/vuln/detail/CVE-2025-32028
