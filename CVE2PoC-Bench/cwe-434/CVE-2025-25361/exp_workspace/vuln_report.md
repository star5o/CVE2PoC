# CVE-2025-25361 Vulnerability Analysis Report

## Vulnerability Overview

| Item | Description |
|------|-------------|
| CVE ID | CVE-2025-25361 |
| Affected Software | PublicCMS |
| Affected Version | V4.0.202406 and earlier |
| Vulnerability Type | CWE-434 (Unrestricted Upload of File with Dangerous Type) |
| CVSS Score | 9.8 (Critical) |

## Vulnerability Description

An arbitrary file upload vulnerability exists in the `/cms/CmsWebFileAdminController.java` component of PublicCMS V4.0.202406. This vulnerability allows authenticated attackers to execute arbitrary code by uploading crafted SVG or XML files containing malicious JavaScript.

## Technical Analysis

### Vulnerable Code Location

The vulnerability exists in the `save` method of `CmsWebFileAdminController.java`:

```java
@RequestMapping("save")
@Csrf
public String save(@RequestAttribute SysSite site, @SessionAttribute SysUser admin, 
                   String path, String content, HttpServletRequest request, ModelMap model) {
    if (CommonUtils.notEmpty(path)) {
        try {
            String suffix = CmsFileUtils.getSuffix(path);
            if (ArrayUtils.contains(safeConfigComponent.getSafeSuffix(site), suffix)) {
                String filepath = siteComponent.getWebFilePath(site.getId(), path);
                content = new String(VerificationUtils.base64Decode(content), Constants.DEFAULT_CHARSET);
                if (CmsFileUtils.createFile(filepath, content)) {
                    // File created without content validation
                }
            }
        }
    }
}
```

### Root Cause

1. The `save` endpoint only validates the file extension against the allowed list
2. No validation of file content is performed before saving
3. SVG files are in the default allowed file types list
4. SVG files can contain JavaScript code that executes in the user's browser

### Attack Vector

1. Attacker logs into the admin panel
2. Navigates to Website File Management
3. Uses "Create File" function to create a malicious SVG file
4. The SVG file content is base64 encoded and sent to `/admin/cmsWebFile/save`
5. File is created without content validation
6. When the SVG file is viewed, the embedded JavaScript executes (Stored XSS)

### Exploitation Method

**Method 1: SVG with embedded script**
```xml
<svg xmlns="http://www.w3.org/2000/svg">
<script type="text/javascript">
alert(document.cookie);
</script>
</svg>
```

**Method 2: XML with XSL transformation**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="#"?>
<root>
<script xmlns="http://www.w3.org/1999/xhtml">
alert('XSS');
</script>
</root>
```

## Impact

- **Session Hijacking**: Attackers can steal admin session cookies
- **Privilege Escalation**: Malicious scripts can perform administrative actions
- **Data Exfiltration**: Sensitive data can be extracted from the admin panel
- **Malware Distribution**: The CMS can be used to host malicious content

## Remediation

1. Validate file content, not just file extensions
2. Sanitize SVG and XML files to remove script tags and event handlers
3. Implement Content Security Policy (CSP) headers
4. Disable inline script execution for uploaded files
5. Use the `isSafe()` content validation for all file creation endpoints

## References

- https://github.com/sanluan/PublicCMS
- https://nvd.nist.gov/vuln/detail/CVE-2025-25361
- https://github.com/c0rdXy/POC/blob/master/CVE/PublicCMS/XSS_02/XSS_02.md
