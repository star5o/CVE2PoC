#!/bin/bash

REPO_URL="https://github.com/sanluan/PublicCMS.git"
VULNERABLE_TAG="V4.0.202406.f"
TARGET_DIR="$(dirname "$0")/source_code"

rm -rf "$TARGET_DIR"

git clone --depth 1 --branch "$VULNERABLE_TAG" "$REPO_URL" "$TARGET_DIR"

if [ $? -eq 0 ]; then
    echo "Successfully cloned PublicCMS $VULNERABLE_TAG to $TARGET_DIR"
else
    echo "Failed to clone with tag $VULNERABLE_TAG, trying alternative tags..."
    git clone "$REPO_URL" "$TARGET_DIR"
    cd "$TARGET_DIR"
    git fetch --tags
    git checkout "$VULNERABLE_TAG" 2>/dev/null || git checkout "v4.0.202406" 2>/dev/null || git checkout $(git tag | grep -i "202406" | head -1)
fi
