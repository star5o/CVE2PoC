# CVE-2025-9406 Vulnerability Report

## Vulnerability Information

- **CVE ID**: CVE-2025-9406
- **CWE ID**: CWE-434 (Unrestricted Upload of File with Dangerous Type)
- **Affected Component**: com.mossle.cms.web.CmsArticleController.uploadImage
- **Affected Version**: xuhuisheng lemon <= 1.13.0
- **Severity**: Medium (CVSS 6.3)

## Vulnerability Description

The `uploadImage` function in `CmsArticleController.java` does not validate the file type of uploaded files. An authenticated attacker can upload arbitrary files including JSP webshells, potentially leading to remote code execution.

## Vulnerable Code

The vulnerable code is located in:
`src/main/java/com/mossle/cms/web/CmsArticleController.java`

```java
@RequestMapping("cms-article-uploadImage")
@ResponseBody
public String uploadImage(@RequestParam("CKEditorFuncNum") String callback,
        @RequestParam("upload") MultipartFile attachment) throws Exception {
    String tenantId = tenantHolder.getTenantId();
    StoreDTO storeDto = storeClient.saveStore("cms/html/r/images",
            new MultipartFileDataSource(attachment), tenantId);

    return "<script type='text/javascript'>"
            + "window.parent.CKEDITOR.tools.callFunction(" + callback
            + ",'" + "r/images/" + storeDto.getKey() + "','')"
            + "</script>";
}
```

The method accepts any file type without validation and stores it in a web-accessible location.

## Attack Flow

1. Attacker authenticates to the application with valid credentials
2. Attacker sends a POST request to `/cms/cms-article-uploadImage.do` with a malicious file
3. The file is stored in `mossle.store/{tenantId}/cms/html/r/images/` directory on the server
4. Depending on server configuration, the uploaded file may be executed or used for other attacks

## Proof of Concept

```bash
cd exp_workspace
conda activate poc
python poc.py http://localhost:18080
```

## Impact

- Remote Code Execution (RCE)
- Server Compromise
- Data Theft
- Lateral Movement within the network

## Remediation

1. Implement file type validation using whitelist approach
2. Validate file content, not just extension
3. Store uploaded files outside web-accessible directories
4. Rename uploaded files to prevent direct execution
5. Update to a patched version when available

## References

- https://github.com/xuhuisheng/lemon/issues/212
- https://cvefeed.io/vuln/detail/CVE-2025-9406
