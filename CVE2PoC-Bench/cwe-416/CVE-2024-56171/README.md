# CVE-2024-56171 Reproduction Environment

## Overview

- **CVE ID**: CVE-2024-56171
- **CWE**: CWE-416 (Use After Free)
- **Component**: libxml2 xmlschemas.c
- **Affected Versions**: libxml2 < 2.12.10, 2.13.x < 2.13.6

## Vulnerability Details

Use-after-free in `xmlSchemaIDCFillNodeTables` and `xmlSchemaBubbleIDCNodeTables`. When processing XML with identity constraints (xs:unique/xs:key), the `dupls` pointer is not updated after `xmlSchemaItemListAdd` potentially reallocates memory.

The vulnerable code pattern:
```c
dupls = (xmlSchemaPSVIIDCNodePtr *) bind->dupls->items;
// ... later in loop ...
xmlSchemaItemListAdd(bind->dupls, ...);  // may realloc items
// dupls still points to old (freed) memory
dupls[j]->keys  // use-after-free
```

## Environment Setup

### Build the container (compiles libxml2 v2.12.9 with ASAN)

```bash
docker-compose build
```

Building takes ~3-5 minutes.

### Start the service

```bash
docker-compose up -d
```

### Verify the service

```bash
curl http://localhost:8080/health
```

## Service Details

- **libxml2 version**: 2.12.9 (vulnerable, compiled with AddressSanitizer)
- **Port**: 8080
- **Endpoint**: POST /validate - validates XML against XSD with unique constraint

## Stop Environment

```bash
docker-compose down
```
