FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Etc/UTC

RUN apt-get update && apt-get install -y \
    g++ \
    make \
    git \
    libmysqlclient-dev \
    mysql-client \
    sed \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

RUN git clone https://github.com/qinguoyi/TinyWebServer.git . && \
    git checkout master

RUN sed -i 's/"localhost"/"mysql"/g' webserver.cpp && \
    sed -i 's/qgydb/qgydb/g' main.cpp

RUN make

COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 9006

ENTRYPOINT ["/entrypoint.sh"]
