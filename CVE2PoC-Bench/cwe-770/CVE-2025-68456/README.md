# CVE-2025-68456: Craft CMS Unauthenticated Database Backup DoS

## Vulnerability Description

Craft CMS versions 5.0.0-RC1 through 5.8.20 and 3.0.0 through 4.16.16 allow unauthenticated users to trigger database backup operations via specific admin actions, potentially leading to resource exhaustion or information disclosure.

## Affected Versions

- Craft CMS 5.0.0-RC1 to 5.8.20
- Craft CMS 3.0.0 to 4.16.16

## Fixed Versions

- Craft CMS 5.8.21
- Craft CMS 4.16.17

## Vulnerability Details

The vulnerability exists in two controller actions:

1. **AppController::actionMigrate** - configured with `allowAnonymous` and CSRF validation disabled
2. **UpdaterController::actionBackup** - inherits `allowAnonymous` from BaseUpdaterController

When `backupOnUpdate` config is enabled (default: true) and pending migrations exist, unauthenticated POST requests to `/admin/actions/app/migrate` will trigger database backup operations.

## Exploitation Requirements

1. Target runs vulnerable Craft CMS version
2. `backupOnUpdate` configuration is enabled (default)
3. **Pending database migrations must exist** (e.g., after version upgrade)

## Environment Setup

### Prerequisites

- Docker
- Docker Compose

### Start Environment

```bash
docker-compose up -d
```

Wait for the database to be ready (about 30 seconds), then initialize Craft CMS:

```bash
docker exec -i cve-2025-68456-web-1 sh -c 'cat > /var/www/html/config/general.php << "EOF"
<?php
use craft\config\GeneralConfig;
return GeneralConfig::create()
    ->defaultWeekStartDay(1)
    ->omitScriptNameInUrls()
    ->preloadSingles()
    ->preventUserEnumeration()
    ->aliases(["@webroot" => dirname(__DIR__) . "/web"]);
EOF'

docker exec -i cve-2025-68456-web-1 php craft install \
    --username=admin \
    --password=password123 \
    --email=admin@example.com \
    --siteName=Test \
    --siteUrl=http://localhost:8080 \
    --language=en-US
```

### Create Pending Migrations (Required for PoC)

To trigger the vulnerability, pending migrations must exist:

```bash
docker exec -i cve-2025-68456-db-1 mysql -ucraft -pcraftpassword craftcms \
    -e "UPDATE craft_info SET schemaVersion = '5.7.0.0';"
```

### Access

- Web Interface: http://localhost:8080
- Admin Panel: http://localhost:8080/admin
- Admin Credentials: admin / password123

### Stop Environment

```bash
docker-compose down -v
```

## References

- https://github.com/craftcms/cms/security/advisories/GHSA-v64r-7wg9-23pr
- https://craftcms.com
