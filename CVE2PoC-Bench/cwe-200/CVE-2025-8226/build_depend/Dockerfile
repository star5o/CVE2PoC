FROM node:20-alpine

WORKDIR /app

RUN apk add --no-cache mysql-client curl

COPY ./vuln_info/source_code/package*.json ./

RUN npm config set registry https://registry.npmmirror.com && \
    npm install

COPY ./vuln_info/source_code/ .

COPY ./build_depend/config.prd.js /app/app/config/config.prd.js
COPY ./build_depend/init.js /app/app/middleware/init.js

COPY ./build_depend/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 3000

ENTRYPOINT ["/entrypoint.sh"]
