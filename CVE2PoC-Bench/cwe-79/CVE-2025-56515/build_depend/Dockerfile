FROM node:14

ARG FIORA_REPO=https://github.com/yinxin630/fiora.git
ARG FIORA_REF=master

WORKDIR /usr/app
RUN git clone --depth 1 --branch ${FIORA_REF} ${FIORA_REPO} /usr/app/fiora

WORKDIR /usr/app/fiora
ENV NPM_CONFIG_REGISTRY=https://registry.npmmirror.com

RUN touch .env && \
    yarn config set registry https://registry.npmmirror.com && \
    yarn install --network-timeout 600000 && \
    yarn build:web

CMD ["yarn", "start"]
