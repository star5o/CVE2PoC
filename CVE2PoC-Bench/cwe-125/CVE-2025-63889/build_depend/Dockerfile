FROM php:7.4-apache

RUN apt-get update && apt-get install -y unzip && rm -rf /var/lib/apt/lists/*

RUN cd /tmp \
 && curl https://codeload.github.com/top-think/think/zip/v5.0.24 -o thinkphp-v5.0.24.zip \
 && unzip thinkphp-v5.0.24.zip \
 && cp -r think-5.0.24/* /var/www/html/ \
 && curl https://codeload.github.com/top-think/framework/zip/v5.0.24 -o framework-5.0.24.zip \
 && unzip framework-5.0.24.zip \
 && cp -r framework-5.0.24 /var/www/html/thinkphp \
 && rm -rf /tmp/*

COPY Index.php /var/www/html/application/index/controller/Index.php

RUN cd /var/www/html \
 && touch .env \
 && echo "app_debug = true" >> .env \
 && echo "app_trace = true" >> .env

ENV APACHE_DOCUMENT_ROOT=/var/www/html/public
RUN sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf \
 && sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf \
 && cd /var/www/html \
 && chown www-data:www-data -R .

WORKDIR /var/www/html
