FROM node:20-alpine

RUN apk update && apk add --no-cache build-base gcc autoconf automake zlib-dev libpng-dev nasm bash vips-dev git python3

WORKDIR /opt/app

COPY package.json ./
RUN npm install

COPY . .
RUN mkdir -p public/uploads .tmp && chmod -R 777 public .tmp
RUN npm run build

EXPOSE 1337

CMD ["npm", "run", "develop"]
