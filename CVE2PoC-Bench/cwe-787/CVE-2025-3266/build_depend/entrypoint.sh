#!/bin/bash

until mysql -h mysql -u root -proot -e "SELECT 1" &>/dev/null; do
    echo "Waiting for MySQL..."
    sleep 2
done

mysql -h mysql -u root -proot -e "CREATE DATABASE IF NOT EXISTS qgydb;"
mysql -h mysql -u root -proot -e "USE qgydb; CREATE TABLE IF NOT EXISTS user(username char(50) NULL, passwd char(50) NULL)ENGINE=InnoDB;"
mysql -h mysql -u root -proot -e "USE qgydb; INSERT INTO user(username, passwd) VALUES('admin', 'admin') ON DUPLICATE KEY UPDATE passwd='admin';"

echo "MySQL initialized"
echo "Starting TinyWebServer..."

exec ./server -p 9006 -l 0 -m 0 -o 0 -s 8 -t 8 -c 1 -a 0
