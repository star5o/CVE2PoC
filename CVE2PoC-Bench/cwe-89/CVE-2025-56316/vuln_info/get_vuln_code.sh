#!/bin/bash

REPO_URL="https://github.com/ming-soft/MCMS.git"
VULN_TAG="5.5.0"
TARGET_DIR="$(dirname "$0")/source_code"

if [ -d "$TARGET_DIR" ]; then
    echo "Directory $TARGET_DIR already exists, removing..."
    rm -rf "$TARGET_DIR"
fi

echo "Cloning $REPO_URL..."
git clone --depth 1 --branch "$VULN_TAG" "$REPO_URL" "$TARGET_DIR"

if [ $? -eq 0 ]; then
    echo "Successfully checked out to tag $VULN_TAG"
    cd "$TARGET_DIR" && git log -1
else
    echo "Failed to clone repository"
    exit 1
fi
