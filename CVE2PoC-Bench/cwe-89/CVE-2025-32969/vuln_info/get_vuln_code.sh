#!/bin/bash

REPO_URL="https://github.com/xwiki/xwiki-platform.git"
VULNERABLE_TAG="xwiki-platform-16.10.0"
OUTPUT_DIR="$(dirname "$0")/source_code"

if [ -d "$OUTPUT_DIR" ]; then
    echo "Source code directory already exists: $OUTPUT_DIR"
    exit 0
fi

echo "Cloning XWiki Platform repository..."
git clone --depth 1 --branch "$VULNERABLE_TAG" "$REPO_URL" "$OUTPUT_DIR"

if [ $? -eq 0 ]; then
    echo "Successfully checked out to $VULNERABLE_TAG"
    echo "Source code is in: $OUTPUT_DIR"
else
    echo "Failed to clone repository"
    exit 1
fi
