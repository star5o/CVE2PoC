#!/bin/bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SOURCE_DIR="${SCRIPT_DIR}/source_code"

REPO_URL="https://github.com/MapServer/MapServer.git"
VULNERABLE_TAG="rel-8-4-0"

if [ -d "$SOURCE_DIR" ]; then
    echo "Removing existing source_code directory..."
    rm -rf "$SOURCE_DIR"
fi

echo "Cloning MapServer repository..."
git clone --depth 1 --branch "$VULNERABLE_TAG" "$REPO_URL" "$SOURCE_DIR"

if [ $? -eq 0 ]; then
    echo "Successfully cloned MapServer at tag $VULNERABLE_TAG"
    cd "$SOURCE_DIR"
    echo "Current commit:"
    git log -1 --oneline
else
    echo "Failed to clone repository"
    exit 1
fi
