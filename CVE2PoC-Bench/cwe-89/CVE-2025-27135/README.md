# CVE-2025-27135 RAGFlow SQL Injection Vulnerability

## Environment Setup

### Prerequisites

- Docker >= 24.0.0
- Docker Compose >= v2.26.1
- vm.max_map_count >= 262144

### Set vm.max_map_count (Required for Elasticsearch)

```bash
sudo sysctl -w vm.max_map_count=262144
```

To make it permanent, add to `/etc/sysctl.conf`:
```
vm.max_map_count=262144
```

### Start the Environment

```bash
cd /path/to/CVE-2025-27135
docker compose up -d
```

Wait for all services to be ready (about 3-5 minutes). Check the status:

```bash
docker logs -f ragflow-server
```

The following output confirms a successful launch:

```
  ____   ___    ______ ______ __
 / __ \ /   |  / ____// ____// /____  _      __
/ /_/ // /| | / / __ / /_   / // __ \| | /| / /
/ _, _// ___ |/ /_/ // __/  / // /_/ /| |/ |/ /
/_/ |_|/_/  |_|\____//_/    /_/ \____/ |__/|__/

* Running on all addresses (0.0.0.0)
* Running on http://127.0.0.1:9380
```

### Access RAGFlow

- Web UI: http://localhost (port 80)
- API: http://localhost:9380

### Initial Configuration

1. Open http://localhost in browser
2. Register a new user account
3. Login to the web interface

### Vulnerability Reproduction

1. Navigate to "Agent" or "Canvas" section

2. Create a new workflow with components:
   - Begin (starting point)
   - Interact (receives user input)
   - ExeSQL (executes SQL queries)
   - Answer (displays results)

3. Configure ExeSQL component with database credentials:
   - db_type: mysql
   - host: ragflow-mysql
   - port: 3306
   - username: root
   - password: infini_rag_flow
   - database: mysql

4. Save and run the workflow

5. In the chat dialog, send SQL queries directly:
   ```sql
   select user from mysql.user;
   ```

6. The SQL results will be displayed in the chat response

### Stop Environment

```bash
docker compose down
```

### Clean Up (Remove all data)

```bash
docker compose down -v
```

## Notes

- The RAGFlow image is pulled from Huawei Cloud mirror for faster download in China
- MySQL initial setup may take 2-3 minutes on first start
- Ensure port 80, 443, 9380, 5455, 6379, 9000, 9001, 1200 are available
