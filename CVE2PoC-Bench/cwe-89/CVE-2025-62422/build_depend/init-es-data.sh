#!/bin/bash

ES_HOST="${ES_HOST:-localhost:9200}"

echo "Waiting for Elasticsearch..."
until curl -s "http://${ES_HOST}/_cluster/health" | grep -q '"status":"green"\|"status":"yellow"'; do
    sleep 2
done

echo "Creating test index..."
curl -X PUT "http://${ES_HOST}/testindex" -H 'Content-Type: application/json' -d '{
  "mappings": {
    "properties": {
      "id": { "type": "integer" },
      "name": { "type": "text" },
      "value": { "type": "float" }
    }
  }
}'

echo "Inserting test data..."
curl -X POST "http://${ES_HOST}/testindex/_doc/1" -H 'Content-Type: application/json' -d '{
  "id": 1,
  "name": "test_data_1",
  "value": 100.5
}'

curl -X POST "http://${ES_HOST}/testindex/_doc/2" -H 'Content-Type: application/json' -d '{
  "id": 2,
  "name": "test_data_2",
  "value": 200.5
}'

echo "Elasticsearch data initialized."
