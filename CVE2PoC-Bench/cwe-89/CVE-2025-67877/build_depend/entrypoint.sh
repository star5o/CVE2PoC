#!/bin/bash
set -e

cd /var/www/html

if [ ! -d "/var/www/html/vendor" ]; then
    echo "Installing composer dependencies..."
    composer install --no-dev --no-interaction --prefer-dist
fi

cat > /var/www/html/Include/Config.php << 'EOF'
<?php
$sSERVERNAME = 'db';
$dbPort = '3306';
$sUSER = 'churchcrm';
$sPASSWORD = 'churchcrm';
$sDATABASE = 'churchcrm';
$TwoFASecretKey = 'ChangeThisToASecureRandomStringBeforeUse';
$sRootPath = '';
$bLockURL = false;
$URL = array();
$URL[0] = 'http://localhost:8067/';
$sGoogleTrackingID = '';
error_reporting(E_ERROR);
require_once dirname(__FILE__).DIRECTORY_SEPARATOR.'LoadConfigs.php';
EOF

chown -R www-data:www-data /var/www/html
chmod -R 755 /var/www/html

apache2-foreground
