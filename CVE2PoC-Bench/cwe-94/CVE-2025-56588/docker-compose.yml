services:
  mariadb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: dolidb
      MYSQL_USER: dolidbuser
      MYSQL_PASSWORD: dolidbpass
    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 10s
      timeout: 5s
      retries: 5

  web:
    image: dolibarr/dolibarr:21.0.1
    environment:
      DOLI_DB_HOST: mariadb
      DOLI_DB_NAME: dolidb
      DOLI_DB_USER: dolidbuser
      DOLI_DB_PASSWORD: dolidbpass
      DOLI_URL_ROOT: "http://localhost:8088"
      DOLI_ADMIN_LOGIN: "admin"
      DOLI_ADMIN_PASSWORD: "admin123"
      DOLI_COMPANY_NAME: "TestCompany"
      DOLI_COMPANY_COUNTRYCODE: "US"
    ports:
      - "8088:80"
    depends_on:
      mariadb:
        condition: service_healthy
