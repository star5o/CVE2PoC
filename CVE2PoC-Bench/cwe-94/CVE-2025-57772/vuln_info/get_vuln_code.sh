#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SOURCE_CODE_DIR="${SCRIPT_DIR}/source_code"

REPO_URL="https://github.com/dataease/dataease.git"
VULNERABLE_TAG="v2.10.11"

rm -rf "${SOURCE_CODE_DIR}"
mkdir -p "${SOURCE_CODE_DIR}"

echo "[*] Cloning DataEase repository..."
git clone --depth 1 --branch "${VULNERABLE_TAG}" "${REPO_URL}" "${SOURCE_CODE_DIR}"

if [ $? -eq 0 ]; then
    echo "[+] Successfully cloned DataEase ${VULNERABLE_TAG} to ${SOURCE_CODE_DIR}"
    cd "${SOURCE_CODE_DIR}"
    echo "[*] Current commit:"
    git log -1 --oneline
else
    echo "[-] Failed to clone repository"
    exit 1
fi
