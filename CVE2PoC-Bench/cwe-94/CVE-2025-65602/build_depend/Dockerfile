FROM node:22-slim

WORKDIR /app

RUN apt-get update && apt-get install -y git && rm -rf /var/lib/apt/lists/*

RUN git clone https://gitee.com/chancms/ChanCMS.git . && \
    git checkout v3.3.4

COPY .env.prd .env.prd

RUN npm config set registry https://registry.npmmirror.com && \
    npm install chanjs@2.0.14 --save && \
    npm install

EXPOSE 3000

CMD ["node", "--env-file=.env.prd", "app.js"]
