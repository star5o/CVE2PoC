FROM maven:3.8.6-eclipse-temurin-8 AS builder

WORKDIR /app

RUN apt-get update && apt-get install -y git

RUN git clone https://github.com/Antabot/White-Jotter.git /app/White-Jotter

WORKDIR /app/White-Jotter/wj

COPY application.properties /app/White-Jotter/wj/src/main/resources/application.properties

RUN mvn clean package -DskipTests -Dmaven.test.skip=true

FROM eclipse-temurin:8-jre

WORKDIR /app

RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

COPY --from=builder /app/White-Jotter/wj/target/*.war /app/app.war

EXPOSE 8443

CMD ["java", "-jar", "/app/app.war"]
