# CVE-2025-26613 Vulnerability Report

## Summary

CVE-2025-26613 is a critical OS Command Injection vulnerability in WeGIA's `gerenciar_backup.php` endpoint. The vulnerability exists in the `file` parameter which is passed unsanitized to `shell_exec()`.

## Vulnerability Details

- **CVE ID**: CVE-2025-26613
- **CWE**: CWE-78 (Improper Neutralization of Special Elements used in an OS Command)
- **CVSS Score**: 10.0 (Critical)
- **Affected Versions**: WeGIA <= 3.2.13
- **Fixed Version**: 3.2.14

## Technical Analysis

### Vulnerable Code Path

1. **gerenciar_backup.php (Line 20)**: `extract($_REQUEST);` extracts user input including `$file`
2. **gerenciar_backup.php (Line 26)**: `shell_exec("cd ".BKP_DIR." && ls $file")` - Direct command injection

### Key Vulnerability Factors

1. **No Input Sanitization**: The `$file` parameter is used directly in `shell_exec()` without any sanitization
2. **Header without Exit**: Lines 5-7 have a redirect but no `exit()`, allowing code execution to continue
3. **permissao() also lacks exit**: The permission check function sends headers but doesn't stop execution

### Attack Vector

The vulnerability allows unauthenticated remote code execution through the `file` parameter:

```bash
curl -X POST http://target/WeGIA/html/configuracao/gerenciar_backup.php \
  --data "file=a;id>/var/www/html/WeGIA/pwned.txt;&action=remove"
```

### Proof of Concept Results

1. **Time-based injection**: Server delayed 5.01 seconds confirming `sleep 5` execution
2. **RCE verification**: Successfully created and retrieved file with arbitrary content
3. **User context**: Commands execute as `www-data` (uid=33)

## Remediation

Upgrade to WeGIA version 3.2.14 or later, which implements proper input validation using:
- `escapeshellarg()` for shell argument sanitization
- Proper `exit()` after security redirects

## References

- GitHub Advisory: GHSA-g3w6-m6w8-p6r2
- NVD: https://nvd.nist.gov/vuln/detail/CVE-2025-26613
