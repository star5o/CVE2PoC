CREATE DATABASE IF NOT EXISTS wegia CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE wegia;

CREATE TABLE IF NOT EXISTS cargo (
    id_cargo INT PRIMARY KEY AUTO_INCREMENT,
    cargo VARCHAR(30)
);

CREATE TABLE IF NOT EXISTS situacao (
    id_situacao INT PRIMARY KEY AUTO_INCREMENT,
    situacoes VARCHAR(30)
);

CREATE TABLE IF NOT EXISTS pessoa (
    id_pessoa INT PRIMARY KEY AUTO_INCREMENT,
    cpf VARCHAR(120),
    senha VARCHAR(70),
    nome VARCHAR(100),
    sobrenome VARCHAR(100),
    sexo CHAR(1),
    telefone VARCHAR(25),
    nivel_acesso TINYINT DEFAULT 0
);

CREATE TABLE IF NOT EXISTS funcionario (
    id_funcionario INT PRIMARY KEY AUTO_INCREMENT,
    id_pessoa INT NOT NULL,
    id_cargo INT NOT NULL,
    id_situacao INT NOT NULL,
    data_admissao DATE NOT NULL,
    ctps VARCHAR(150) NOT NULL,
    FOREIGN KEY (id_pessoa) REFERENCES pessoa(id_pessoa),
    FOREIGN KEY (id_cargo) REFERENCES cargo(id_cargo),
    FOREIGN KEY (id_situacao) REFERENCES situacao(id_situacao)
);

CREATE TABLE IF NOT EXISTS recurso (
    id_recurso INT PRIMARY KEY AUTO_INCREMENT,
    recurso VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS acao (
    id_acao INT PRIMARY KEY AUTO_INCREMENT,
    descricao VARCHAR(240)
);

CREATE TABLE IF NOT EXISTS permissao (
    id_permissao INT PRIMARY KEY AUTO_INCREMENT,
    id_cargo INT NOT NULL,
    id_recurso INT NOT NULL,
    id_acao INT NOT NULL,
    FOREIGN KEY (id_cargo) REFERENCES cargo(id_cargo),
    FOREIGN KEY (id_recurso) REFERENCES recurso(id_recurso),
    FOREIGN KEY (id_acao) REFERENCES acao(id_acao)
);

INSERT INTO cargo (id_cargo, cargo) VALUES (1, 'Admin');
INSERT INTO situacao (id_situacao, situacoes) VALUES (1, 'Ativo');
INSERT INTO pessoa (id_pessoa, cpf, senha, nome, nivel_acesso) VALUES (1, '12345678901', MD5('admin123'), 'Admin', 9);
INSERT INTO funcionario (id_funcionario, id_pessoa, id_cargo, id_situacao, data_admissao, ctps) VALUES (1, 1, 1, 1, '2024-01-01', '12345');
INSERT INTO recurso (id_recurso, recurso) VALUES (9, 'Configuracao');
INSERT INTO acao (id_acao, descricao) VALUES (1, 'View'), (2, 'Edit'), (3, 'Delete');
INSERT INTO permissao (id_cargo, id_recurso, id_acao) VALUES (1, 9, 3);
